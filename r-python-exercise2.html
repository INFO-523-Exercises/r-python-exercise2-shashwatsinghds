<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Shashwat Singh">
<meta name="description" content="Data Preprocessing in R: Practice basic R commands/methods for descriptive data analysis. Learn various techniques like Loading and Cleaning data, Scaling and Normalization of data for easier visual representation.">

<title>r-python-exercise2</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="r-python-exercise2_files/libs/clipboard/clipboard.min.js"></script>
<script src="r-python-exercise2_files/libs/quarto-html/quarto.js"></script>
<script src="r-python-exercise2_files/libs/quarto-html/popper.min.js"></script>
<script src="r-python-exercise2_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="r-python-exercise2_files/libs/quarto-html/anchor.min.js"></script>
<link href="r-python-exercise2_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="r-python-exercise2_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="r-python-exercise2_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="r-python-exercise2_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="r-python-exercise2_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">r-python-exercise2</h1>
</div>

<div>
  <div class="description">
    Data Preprocessing in R: Practice basic R commands/methods for descriptive data analysis. Learn various techniques like Loading and Cleaning data, Scaling and Normalization of data for easier visual representation.
  </div>
</div>


<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Shashwat Singh </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<section id="loading-required-packages" class="level1">
<h1>Loading Required Packages</h1>
</section>
<section id="loading-data" class="level1">
<h1>Loading Data</h1>
<section id="csv-files.csv" class="level2">
<h2 class="anchored" data-anchor-id="csv-files.csv"><strong>CSV Files(<code>.csv</code>)</strong></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">#data &lt;- read_csv(here("data", "x.csv"))</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co">#data &lt;- read_csv("Users/shashwatsingh/Documents/GitHub/r-python-exercise2-shashwatsinghds/data/x.tsv")</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>data <span class="sc">|&gt;</span> <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>function (..., list = character(), package = NULL, lib.loc = NULL, verbose = getOption("verbose"), 
    envir = .GlobalEnv, overwrite = TRUE)  </code></pre>
</div>
</div>
<p>The |&gt; is the Base R pipe as opposed to the magrittr pipe |&gt;. The |&gt; pipe can be utilized for most functions in R, while the |&gt; pipe is more restricted towards the tidyverse.</p>
</section>
<section id="tab-separated-values-x.tsv" class="level2">
<h2 class="anchored" data-anchor-id="tab-separated-values-x.tsv"><strong>Tab separated values (<code>x.tsv</code>)</strong></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>data<span class="ot">&lt;-</span><span class="fu">read_delim</span>(<span class="st">"/Users/shashwatsingh/Documents/GitHub/r-python-exercise2-shashwatsinghds/data/x.tsv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 4 Columns: 3
── Column specification ────────────────────────────────────────────────────────
Delimiter: "\t"
chr (1): Name
dbl (2): ID, Age

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">#data&lt;-read_delim(here("data","x.tsv"))</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>data <span class="sc">|&gt;</span> <span class="fu">glimpse</span>() </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 4
Columns: 3
$ ID   &lt;dbl&gt; 12345, 12346, 12347, 12348
$ Name &lt;chr&gt; "Amy", "Ana", "June", "May"
$ Age  &lt;dbl&gt; 13, 14, NA, 21</code></pre>
</div>
</div>
</section>
</section>
<section id="importing-data-from-mysql-database" class="level1">
<h1>Importing data from MySQL database</h1>
<p>First connect to a database in a MySQL database management system, then query tables in the database to obtain desired dataset.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>drv <span class="ot">&lt;-</span> <span class="fu">dbDriver</span>(<span class="st">"MySQL"</span>) <span class="co">#Creating a database driver object specific to MySQL</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Skipping </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Get a connection to my local mysql database etcsite_charaparser.(Skipping this step as I don’t have a local db setup)</p>
</section>
<section id="data-cleaning" class="level1">
<h1>Data Cleaning</h1>
<section id="wide-vs-long-format" class="level2">
<h2 class="anchored" data-anchor-id="wide-vs-long-format">Wide vs Long format</h2>
<p>Read data in wide format</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>wide <span class="ot">&lt;-</span> <span class="fu">read_delim</span>(<span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"wide.txt"</span>), <span class="at">delim =</span> <span class="st">" "</span>, <span class="at">skip =</span> <span class="dv">1</span>, <span class="at">col_names =</span> <span class="fu">c</span>(<span class="st">"Name"</span>, <span class="st">"Math"</span>, <span class="st">"English"</span>, <span class="st">"Degree_Year"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 3 Columns: 4
── Column specification ────────────────────────────────────────────────────────
Delimiter: " "
chr (2): Name, Degree_Year
dbl (2): Math, English

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co">#wide &lt;- read_delim("/Users/shashwatsingh/Documents/GitHub/r-python-exercise2-shashwatsinghds/data/wide.txt", delim = " ", skip = 1, col_names = c("Name", "Math", "English", "Degree_Year"))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The wide format uses the values (<code>Math</code>, <code>English</code>) of variable <code>Subjects</code> as variables.</p>
<p>The long format should have <code>Name</code>, <code>Subject</code>, and <code>Grade</code> as variables (i.e., columns).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>long<span class="ot">&lt;-</span> wide<span class="sc">|&gt;</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols=</span><span class="fu">c</span> (Math,English),</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">names_to=</span><span class="st">"Subject"</span>,</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">values_to=</span> <span class="st">"Grade"</span>)</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>long</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 4
  Name  Degree_Year Subject Grade
  &lt;chr&gt; &lt;chr&gt;       &lt;chr&gt;   &lt;dbl&gt;
1 Anna  Bio_2014    Math       86
2 Anna  Bio_2014    English    90
3 John  Math_2013   Math       43
4 John  Math_2013   English    75
5 Cath  Bio_2012    Math       80
6 Cath  Bio_2012    English    82</code></pre>
</div>
</div>
</section>
<section id="long-to-wide-use-spread" class="level2">
<h2 class="anchored" data-anchor-id="long-to-wide-use-spread"><strong>Long to wide, use <code>spread()</code></strong></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>wide <span class="ot">&lt;-</span> long <span class="sc">%&gt;%</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> Subject, <span class="at">values_from =</span> Grade)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>wide</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 4
  Name  Degree_Year  Math English
  &lt;chr&gt; &lt;chr&gt;       &lt;dbl&gt;   &lt;dbl&gt;
1 Anna  Bio_2014       86      90
2 John  Math_2013      43      75
3 Cath  Bio_2012       80      82</code></pre>
</div>
</div>
</section>
<section id="split-a-column-into-multiple-columns" class="level2">
<h2 class="anchored" data-anchor-id="split-a-column-into-multiple-columns"><strong>Split a column into multiple columns</strong></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>clean <span class="ot">&lt;-</span> long <span class="sc">%&gt;%</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(Degree_Year, <span class="fu">c</span>(<span class="st">"Degree"</span>, <span class="st">"Year"</span>), <span class="at">sep =</span> <span class="st">"_"</span>)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>clean</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 5
  Name  Degree Year  Subject Grade
  &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt;   &lt;dbl&gt;
1 Anna  Bio    2014  Math       86
2 Anna  Bio    2014  English    90
3 John  Math   2013  Math       43
4 John  Math   2013  English    75
5 Cath  Bio    2012  Math       80
6 Cath  Bio    2012  English    82</code></pre>
</div>
</div>
</section>
<section id="handling-datetime-and-time-zones" class="level2">
<h2 class="anchored" data-anchor-id="handling-datetime-and-time-zones"><strong>Handling date/time and time zones</strong></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(<span class="st">"lubridate"</span>))</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">install.packages</span>(<span class="st">"lubridate"</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Convert dates of variance formats into one format:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>mixed.dates <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">20140123</span>, <span class="st">"2019-12-12"</span>, <span class="st">"2009/5/1"</span>,</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a> <span class="st">"measured on 2002-12-06"</span>, <span class="st">"2018-7/16"</span>)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>clean.dates <span class="ot">&lt;-</span> <span class="fu">ymd</span>(mixed.dates) <span class="co">#convert to year-month-day format</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>clean.dates</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2014-01-23" "2019-12-12" "2009-05-01" "2002-12-06" "2018-07-16"</code></pre>
</div>
</div>
<p>Extract day, week, month, year info from dates:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">Dates =</span> clean.dates, <span class="at">WeekDay =</span> <span class="fu">wday</span>(clean.dates), <span class="at">nWeekDay =</span> <span class="fu">wday</span>(clean.dates, <span class="at">label =</span> <span class="cn">TRUE</span>), <span class="at">Year =</span> <span class="fu">year</span>(clean.dates), <span class="at">Month =</span> <span class="fu">month</span>(clean.dates, <span class="at">label =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       Dates WeekDay nWeekDay Year Month
1 2014-01-23       5      Thu 2014   Jan
2 2019-12-12       5      Thu 2019   Dec
3 2009-05-01       6      Fri 2009   May
4 2002-12-06       6      Fri 2002   Dec
5 2018-07-16       2      Mon 2018   Jul</code></pre>
</div>
</div>
<p>Time zone:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>date.time <span class="ot">&lt;-</span> <span class="fu">ymd_hms</span>(<span class="st">"20190203 03:00:03"</span>, <span class="at">tz=</span><span class="st">"Asia/Shanghai"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Convert to Phoenix time:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">with_tz</span>(date.time, <span class="at">tz=</span><span class="st">"America/Phoenix"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2019-02-02 12:00:03 MST"</code></pre>
</div>
</div>
<p>Change the timezone for a time:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">force_tz</span>(date.time, <span class="st">"Turkey"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2019-02-03 03:00:03 +03"</code></pre>
</div>
</div>
<p>Check available time zones:</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>  [1] "Africa/Abidjan"                   "Africa/Accra"                    
  [3] "Africa/Addis_Ababa"               "Africa/Algiers"                  
  [5] "Africa/Asmara"                    "Africa/Asmera"                   
  [7] "Africa/Bamako"                    "Africa/Bangui"                   
  [9] "Africa/Banjul"                    "Africa/Bissau"                   
 [11] "Africa/Blantyre"                  "Africa/Brazzaville"              
 [13] "Africa/Bujumbura"                 "Africa/Cairo"                    
 [15] "Africa/Casablanca"                "Africa/Ceuta"                    
 [17] "Africa/Conakry"                   "Africa/Dakar"                    
 [19] "Africa/Dar_es_Salaam"             "Africa/Djibouti"                 
 [21] "Africa/Douala"                    "Africa/El_Aaiun"                 
 [23] "Africa/Freetown"                  "Africa/Gaborone"                 
 [25] "Africa/Harare"                    "Africa/Johannesburg"             
 [27] "Africa/Juba"                      "Africa/Kampala"                  
 [29] "Africa/Khartoum"                  "Africa/Kigali"                   
 [31] "Africa/Kinshasa"                  "Africa/Lagos"                    
 [33] "Africa/Libreville"                "Africa/Lome"                     
 [35] "Africa/Luanda"                    "Africa/Lubumbashi"               
 [37] "Africa/Lusaka"                    "Africa/Malabo"                   
 [39] "Africa/Maputo"                    "Africa/Maseru"                   
 [41] "Africa/Mbabane"                   "Africa/Mogadishu"                
 [43] "Africa/Monrovia"                  "Africa/Nairobi"                  
 [45] "Africa/Ndjamena"                  "Africa/Niamey"                   
 [47] "Africa/Nouakchott"                "Africa/Ouagadougou"              
 [49] "Africa/Porto-Novo"                "Africa/Sao_Tome"                 
 [51] "Africa/Timbuktu"                  "Africa/Tripoli"                  
 [53] "Africa/Tunis"                     "Africa/Windhoek"                 
 [55] "America/Adak"                     "America/Anchorage"               
 [57] "America/Anguilla"                 "America/Antigua"                 
 [59] "America/Araguaina"                "America/Argentina/Buenos_Aires"  
 [61] "America/Argentina/Catamarca"      "America/Argentina/ComodRivadavia"
 [63] "America/Argentina/Cordoba"        "America/Argentina/Jujuy"         
 [65] "America/Argentina/La_Rioja"       "America/Argentina/Mendoza"       
 [67] "America/Argentina/Rio_Gallegos"   "America/Argentina/Salta"         
 [69] "America/Argentina/San_Juan"       "America/Argentina/San_Luis"      
 [71] "America/Argentina/Tucuman"        "America/Argentina/Ushuaia"       
 [73] "America/Aruba"                    "America/Asuncion"                
 [75] "America/Atikokan"                 "America/Atka"                    
 [77] "America/Bahia"                    "America/Bahia_Banderas"          
 [79] "America/Barbados"                 "America/Belem"                   
 [81] "America/Belize"                   "America/Blanc-Sablon"            
 [83] "America/Boa_Vista"                "America/Bogota"                  
 [85] "America/Boise"                    "America/Buenos_Aires"            
 [87] "America/Cambridge_Bay"            "America/Campo_Grande"            
 [89] "America/Cancun"                   "America/Caracas"                 
 [91] "America/Catamarca"                "America/Cayenne"                 
 [93] "America/Cayman"                   "America/Chicago"                 
 [95] "America/Chihuahua"                "America/Coral_Harbour"           
 [97] "America/Cordoba"                  "America/Costa_Rica"              
 [99] "America/Creston"                  "America/Cuiaba"                  
[101] "America/Curacao"                  "America/Danmarkshavn"            
[103] "America/Dawson"                   "America/Dawson_Creek"            
[105] "America/Denver"                   "America/Detroit"                 
[107] "America/Dominica"                 "America/Edmonton"                
[109] "America/Eirunepe"                 "America/El_Salvador"             
[111] "America/Ensenada"                 "America/Fort_Nelson"             
[113] "America/Fort_Wayne"               "America/Fortaleza"               
[115] "America/Glace_Bay"                "America/Godthab"                 
[117] "America/Goose_Bay"                "America/Grand_Turk"              
[119] "America/Grenada"                  "America/Guadeloupe"              
[121] "America/Guatemala"                "America/Guayaquil"               
[123] "America/Guyana"                   "America/Halifax"                 
[125] "America/Havana"                   "America/Hermosillo"              
[127] "America/Indiana/Indianapolis"     "America/Indiana/Knox"            
[129] "America/Indiana/Marengo"          "America/Indiana/Petersburg"      
[131] "America/Indiana/Tell_City"        "America/Indiana/Vevay"           
[133] "America/Indiana/Vincennes"        "America/Indiana/Winamac"         
[135] "America/Indianapolis"             "America/Inuvik"                  
[137] "America/Iqaluit"                  "America/Jamaica"                 
[139] "America/Jujuy"                    "America/Juneau"                  
[141] "America/Kentucky/Louisville"      "America/Kentucky/Monticello"     
[143] "America/Knox_IN"                  "America/Kralendijk"              
[145] "America/La_Paz"                   "America/Lima"                    
[147] "America/Los_Angeles"              "America/Louisville"              
[149] "America/Lower_Princes"            "America/Maceio"                  
[151] "America/Managua"                  "America/Manaus"                  
[153] "America/Marigot"                  "America/Martinique"              
[155] "America/Matamoros"                "America/Mazatlan"                
[157] "America/Mendoza"                  "America/Menominee"               
[159] "America/Merida"                   "America/Metlakatla"              
[161] "America/Mexico_City"              "America/Miquelon"                
[163] "America/Moncton"                  "America/Monterrey"               
[165] "America/Montevideo"               "America/Montreal"                
[167] "America/Montserrat"               "America/Nassau"                  
[169] "America/New_York"                 "America/Nipigon"                 
[171] "America/Nome"                     "America/Noronha"                 
[173] "America/North_Dakota/Beulah"      "America/North_Dakota/Center"     
[175] "America/North_Dakota/New_Salem"   "America/Nuuk"                    
[177] "America/Ojinaga"                  "America/Panama"                  
[179] "America/Pangnirtung"              "America/Paramaribo"              
[181] "America/Phoenix"                  "America/Port_of_Spain"           
[183] "America/Port-au-Prince"           "America/Porto_Acre"              
[185] "America/Porto_Velho"              "America/Puerto_Rico"             
[187] "America/Punta_Arenas"             "America/Rainy_River"             
[189] "America/Rankin_Inlet"             "America/Recife"                  
[191] "America/Regina"                   "America/Resolute"                
[193] "America/Rio_Branco"               "America/Rosario"                 
[195] "America/Santa_Isabel"             "America/Santarem"                
[197] "America/Santiago"                 "America/Santo_Domingo"           
[199] "America/Sao_Paulo"                "America/Scoresbysund"            
[201] "America/Shiprock"                 "America/Sitka"                   
[203] "America/St_Barthelemy"            "America/St_Johns"                
[205] "America/St_Kitts"                 "America/St_Lucia"                
[207] "America/St_Thomas"                "America/St_Vincent"              
[209] "America/Swift_Current"            "America/Tegucigalpa"             
[211] "America/Thule"                    "America/Thunder_Bay"             
[213] "America/Tijuana"                  "America/Toronto"                 
[215] "America/Tortola"                  "America/Vancouver"               
[217] "America/Virgin"                   "America/Whitehorse"              
[219] "America/Winnipeg"                 "America/Yakutat"                 
[221] "America/Yellowknife"              "Antarctica/Casey"                
[223] "Antarctica/Davis"                 "Antarctica/DumontDUrville"       
[225] "Antarctica/Macquarie"             "Antarctica/Mawson"               
[227] "Antarctica/McMurdo"               "Antarctica/Palmer"               
[229] "Antarctica/Rothera"               "Antarctica/South_Pole"           
[231] "Antarctica/Syowa"                 "Antarctica/Troll"                
[233] "Antarctica/Vostok"                "Arctic/Longyearbyen"             
[235] "Asia/Aden"                        "Asia/Almaty"                     
[237] "Asia/Amman"                       "Asia/Anadyr"                     
[239] "Asia/Aqtau"                       "Asia/Aqtobe"                     
[241] "Asia/Ashgabat"                    "Asia/Ashkhabad"                  
[243] "Asia/Atyrau"                      "Asia/Baghdad"                    
[245] "Asia/Bahrain"                     "Asia/Baku"                       
[247] "Asia/Bangkok"                     "Asia/Barnaul"                    
[249] "Asia/Beirut"                      "Asia/Bishkek"                    
[251] "Asia/Brunei"                      "Asia/Calcutta"                   
[253] "Asia/Chita"                       "Asia/Choibalsan"                 
[255] "Asia/Chongqing"                   "Asia/Chungking"                  
[257] "Asia/Colombo"                     "Asia/Dacca"                      
[259] "Asia/Damascus"                    "Asia/Dhaka"                      
[261] "Asia/Dili"                        "Asia/Dubai"                      
[263] "Asia/Dushanbe"                    "Asia/Famagusta"                  
[265] "Asia/Gaza"                        "Asia/Harbin"                     
[267] "Asia/Hebron"                      "Asia/Ho_Chi_Minh"                
[269] "Asia/Hong_Kong"                   "Asia/Hovd"                       
[271] "Asia/Irkutsk"                     "Asia/Istanbul"                   
[273] "Asia/Jakarta"                     "Asia/Jayapura"                   
[275] "Asia/Jerusalem"                   "Asia/Kabul"                      
[277] "Asia/Kamchatka"                   "Asia/Karachi"                    
[279] "Asia/Kashgar"                     "Asia/Kathmandu"                  
[281] "Asia/Katmandu"                    "Asia/Khandyga"                   
[283] "Asia/Kolkata"                     "Asia/Krasnoyarsk"                
[285] "Asia/Kuala_Lumpur"                "Asia/Kuching"                    
[287] "Asia/Kuwait"                      "Asia/Macao"                      
[289] "Asia/Macau"                       "Asia/Magadan"                    
[291] "Asia/Makassar"                    "Asia/Manila"                     
[293] "Asia/Muscat"                      "Asia/Nicosia"                    
[295] "Asia/Novokuznetsk"                "Asia/Novosibirsk"                
[297] "Asia/Omsk"                        "Asia/Oral"                       
[299] "Asia/Phnom_Penh"                  "Asia/Pontianak"                  
[301] "Asia/Pyongyang"                   "Asia/Qatar"                      
[303] "Asia/Qostanay"                    "Asia/Qyzylorda"                  
[305] "Asia/Rangoon"                     "Asia/Riyadh"                     
[307] "Asia/Saigon"                      "Asia/Sakhalin"                   
[309] "Asia/Samarkand"                   "Asia/Seoul"                      
[311] "Asia/Shanghai"                    "Asia/Singapore"                  
[313] "Asia/Srednekolymsk"               "Asia/Taipei"                     
[315] "Asia/Tashkent"                    "Asia/Tbilisi"                    
[317] "Asia/Tehran"                      "Asia/Tel_Aviv"                   
[319] "Asia/Thimbu"                      "Asia/Thimphu"                    
[321] "Asia/Tokyo"                       "Asia/Tomsk"                      
[323] "Asia/Ujung_Pandang"               "Asia/Ulaanbaatar"                
[325] "Asia/Ulan_Bator"                  "Asia/Urumqi"                     
[327] "Asia/Ust-Nera"                    "Asia/Vientiane"                  
[329] "Asia/Vladivostok"                 "Asia/Yakutsk"                    
[331] "Asia/Yangon"                      "Asia/Yekaterinburg"              
[333] "Asia/Yerevan"                     "Atlantic/Azores"                 
[335] "Atlantic/Bermuda"                 "Atlantic/Canary"                 
[337] "Atlantic/Cape_Verde"              "Atlantic/Faeroe"                 
[339] "Atlantic/Faroe"                   "Atlantic/Jan_Mayen"              
[341] "Atlantic/Madeira"                 "Atlantic/Reykjavik"              
[343] "Atlantic/South_Georgia"           "Atlantic/St_Helena"              
[345] "Atlantic/Stanley"                 "Australia/ACT"                   
[347] "Australia/Adelaide"               "Australia/Brisbane"              
[349] "Australia/Broken_Hill"            "Australia/Canberra"              
[351] "Australia/Currie"                 "Australia/Darwin"                
[353] "Australia/Eucla"                  "Australia/Hobart"                
[355] "Australia/LHI"                    "Australia/Lindeman"              
[357] "Australia/Lord_Howe"              "Australia/Melbourne"             
[359] "Australia/North"                  "Australia/NSW"                   
[361] "Australia/Perth"                  "Australia/Queensland"            
[363] "Australia/South"                  "Australia/Sydney"                
[365] "Australia/Tasmania"               "Australia/Victoria"              
[367] "Australia/West"                   "Australia/Yancowinna"            
[369] "Brazil/Acre"                      "Brazil/DeNoronha"                
[371] "Brazil/East"                      "Brazil/West"                     
[373] "Canada/Atlantic"                  "Canada/Central"                  
[375] "Canada/Eastern"                   "Canada/Mountain"                 
[377] "Canada/Newfoundland"              "Canada/Pacific"                  
[379] "Canada/Saskatchewan"              "Canada/Yukon"                    
[381] "CET"                              "Chile/Continental"               
[383] "Chile/EasterIsland"               "CST6CDT"                         
[385] "Cuba"                             "EET"                             
[387] "Egypt"                            "Eire"                            
[389] "EST"                              "EST5EDT"                         
[391] "Etc/GMT"                          "Etc/GMT-0"                       
[393] "Etc/GMT-1"                        "Etc/GMT-10"                      
[395] "Etc/GMT-11"                       "Etc/GMT-12"                      
[397] "Etc/GMT-13"                       "Etc/GMT-14"                      
[399] "Etc/GMT-2"                        "Etc/GMT-3"                       
[401] "Etc/GMT-4"                        "Etc/GMT-5"                       
[403] "Etc/GMT-6"                        "Etc/GMT-7"                       
[405] "Etc/GMT-8"                        "Etc/GMT-9"                       
[407] "Etc/GMT+0"                        "Etc/GMT+1"                       
[409] "Etc/GMT+10"                       "Etc/GMT+11"                      
[411] "Etc/GMT+12"                       "Etc/GMT+2"                       
[413] "Etc/GMT+3"                        "Etc/GMT+4"                       
[415] "Etc/GMT+5"                        "Etc/GMT+6"                       
[417] "Etc/GMT+7"                        "Etc/GMT+8"                       
[419] "Etc/GMT+9"                        "Etc/GMT0"                        
[421] "Etc/Greenwich"                    "Etc/UCT"                         
[423] "Etc/Universal"                    "Etc/UTC"                         
[425] "Etc/Zulu"                         "Europe/Amsterdam"                
[427] "Europe/Andorra"                   "Europe/Astrakhan"                
[429] "Europe/Athens"                    "Europe/Belfast"                  
[431] "Europe/Belgrade"                  "Europe/Berlin"                   
[433] "Europe/Bratislava"                "Europe/Brussels"                 
[435] "Europe/Bucharest"                 "Europe/Budapest"                 
[437] "Europe/Busingen"                  "Europe/Chisinau"                 
[439] "Europe/Copenhagen"                "Europe/Dublin"                   
[441] "Europe/Gibraltar"                 "Europe/Guernsey"                 
[443] "Europe/Helsinki"                  "Europe/Isle_of_Man"              
[445] "Europe/Istanbul"                  "Europe/Jersey"                   
[447] "Europe/Kaliningrad"               "Europe/Kiev"                     
[449] "Europe/Kirov"                     "Europe/Lisbon"                   
[451] "Europe/Ljubljana"                 "Europe/London"                   
[453] "Europe/Luxembourg"                "Europe/Madrid"                   
[455] "Europe/Malta"                     "Europe/Mariehamn"                
[457] "Europe/Minsk"                     "Europe/Monaco"                   
[459] "Europe/Moscow"                    "Europe/Nicosia"                  
[461] "Europe/Oslo"                      "Europe/Paris"                    
[463] "Europe/Podgorica"                 "Europe/Prague"                   
[465] "Europe/Riga"                      "Europe/Rome"                     
[467] "Europe/Samara"                    "Europe/San_Marino"               
[469] "Europe/Sarajevo"                  "Europe/Saratov"                  
[471] "Europe/Simferopol"                "Europe/Skopje"                   
[473] "Europe/Sofia"                     "Europe/Stockholm"                
[475] "Europe/Tallinn"                   "Europe/Tirane"                   
[477] "Europe/Tiraspol"                  "Europe/Ulyanovsk"                
[479] "Europe/Uzhgorod"                  "Europe/Vaduz"                    
[481] "Europe/Vatican"                   "Europe/Vienna"                   
[483] "Europe/Vilnius"                   "Europe/Volgograd"                
[485] "Europe/Warsaw"                    "Europe/Zagreb"                   
[487] "Europe/Zaporozhye"                "Europe/Zurich"                   
[489] "Factory"                          "GB"                              
[491] "GB-Eire"                          "GMT"                             
[493] "GMT-0"                            "GMT+0"                           
[495] "GMT0"                             "Greenwich"                       
[497] "Hongkong"                         "HST"                             
[499] "Iceland"                          "Indian/Antananarivo"             
[501] "Indian/Chagos"                    "Indian/Christmas"                
[503] "Indian/Cocos"                     "Indian/Comoro"                   
[505] "Indian/Kerguelen"                 "Indian/Mahe"                     
[507] "Indian/Maldives"                  "Indian/Mauritius"                
[509] "Indian/Mayotte"                   "Indian/Reunion"                  
[511] "Iran"                             "Israel"                          
[513] "Jamaica"                          "Japan"                           
[515] "Kwajalein"                        "Libya"                           
[517] "MET"                              "Mexico/BajaNorte"                
[519] "Mexico/BajaSur"                   "Mexico/General"                  
[521] "MST"                              "MST7MDT"                         
[523] "Navajo"                           "NZ"                              
[525] "NZ-CHAT"                          "Pacific/Apia"                    
[527] "Pacific/Auckland"                 "Pacific/Bougainville"            
[529] "Pacific/Chatham"                  "Pacific/Chuuk"                   
[531] "Pacific/Easter"                   "Pacific/Efate"                   
[533] "Pacific/Enderbury"                "Pacific/Fakaofo"                 
[535] "Pacific/Fiji"                     "Pacific/Funafuti"                
[537] "Pacific/Galapagos"                "Pacific/Gambier"                 
[539] "Pacific/Guadalcanal"              "Pacific/Guam"                    
[541] "Pacific/Honolulu"                 "Pacific/Johnston"                
[543] "Pacific/Kanton"                   "Pacific/Kiritimati"              
[545] "Pacific/Kosrae"                   "Pacific/Kwajalein"               
[547] "Pacific/Majuro"                   "Pacific/Marquesas"               
[549] "Pacific/Midway"                   "Pacific/Nauru"                   
[551] "Pacific/Niue"                     "Pacific/Norfolk"                 
[553] "Pacific/Noumea"                   "Pacific/Pago_Pago"               
[555] "Pacific/Palau"                    "Pacific/Pitcairn"                
[557] "Pacific/Pohnpei"                  "Pacific/Ponape"                  
[559] "Pacific/Port_Moresby"             "Pacific/Rarotonga"               
[561] "Pacific/Saipan"                   "Pacific/Samoa"                   
[563] "Pacific/Tahiti"                   "Pacific/Tarawa"                  
[565] "Pacific/Tongatapu"                "Pacific/Truk"                    
[567] "Pacific/Wake"                     "Pacific/Wallis"                  
[569] "Pacific/Yap"                      "Poland"                          
[571] "Portugal"                         "PRC"                             
[573] "PST8PDT"                          "ROC"                             
[575] "ROK"                              "Singapore"                       
[577] "Turkey"                           "UCT"                             
[579] "Universal"                        "US/Alaska"                       
[581] "US/Aleutian"                      "US/Arizona"                      
[583] "US/Central"                       "US/East-Indiana"                 
[585] "US/Eastern"                       "US/Hawaii"                       
[587] "US/Indiana-Starke"                "US/Michigan"                     
[589] "US/Mountain"                      "US/Pacific"                      
[591] "US/Samoa"                         "UTC"                             
[593] "W-SU"                             "WET"                             
[595] "Zulu"                            
attr(,"Version")
[1] "2022a"</code></pre>
</div>
</div>
</section>
<section id="string-processing" class="level2">
<h2 class="anchored" data-anchor-id="string-processing">String Processing</h2>
<p>Common needs: stringr package</p>
<p>Advanced needs: stringi package</p>
<p>The following code shows the use of functions provided by stringr package to put column names back to a dataset fetched from http://archive.ics.uci.edu/ml/machine-learning-databases/audiology/</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>uci.repo <span class="ot">&lt;-</span><span class="st">"http://archive.ics.uci.edu/ml/machine-learning-databases/"</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>dataset <span class="ot">&lt;-</span> <span class="st">"audiology/audiology.standardized"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>str_c: used for string concatenation:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>dataF <span class="ot">&lt;-</span> <span class="fu">str_c</span>(uci.repo, dataset, <span class="st">".data"</span>)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>namesF <span class="ot">&lt;-</span> <span class="fu">str_c</span>(uci.repo, dataset, <span class="st">".names"</span>)</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>dataF</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "http://archive.ics.uci.edu/ml/machine-learning-databases/audiology/audiology.standardized.data"</code></pre>
</div>
</div>
<p>Read the data file:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="fu">url</span>(dataF), <span class="at">col_names =</span> <span class="cn">FALSE</span>, <span class="at">na=</span><span class="st">"?"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 200 Columns: 71
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (11): X2, X4, X5, X6, X8, X59, X60, X64, X66, X70, X71
lgl (60): X1, X3, X7, X9, X10, X11, X12, X13, X14, X15, X16, X17, X18, X19, ...

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
</div>
<p>Get No Of Rows and Columns:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 200  71</code></pre>
</div>
</div>
<p>Read the name file line by line, put the lines in a vector:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>lines <span class="ot">&lt;-</span> <span class="fu">read_lines</span>(<span class="fu">url</span>(namesF))</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>lines <span class="sc">|&gt;</span> <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "WARNING: This database should be credited to the original owner whenever"
[2] "         used for any publication whatsoever."                           
[3] ""                                                                        
[4] "1. Title: Standardized Audiology Database "                              
[5] ""                                                                        
[6] "2. Sources:"                                                             </code></pre>
</div>
</div>
<p>Examine the content of lines and see the column names start on line 67, ends on line 135. Then, get column name lines and clean up to get column names:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>names <span class="ot">&lt;-</span> lines[<span class="dv">67</span><span class="sc">:</span><span class="dv">135</span>]</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>names</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "   age_gt_60:\t\t     f, t."                                          
 [2] "   air():\t\t     mild,moderate,severe,normal,profound."              
 [3] "   airBoneGap:\t\t     f, t."                                         
 [4] "   ar_c():\t\t     normal,elevated,absent."                           
 [5] "   ar_u():\t\t     normal,absent,elevated."                           
 [6] "   bone():\t\t     mild,moderate,normal,unmeasured."                  
 [7] "   boneAbnormal:\t     f, t."                                         
 [8] "   bser():\t\t     normal,degraded."                                  
 [9] "   history_buzzing:\t     f, t."                                      
[10] "   history_dizziness:\t     f, t."                                    
[11] "   history_fluctuating:\t     f, t."                                  
[12] "   history_fullness:\t     f, t."                                     
[13] "   history_heredity:\t     f, t."                                     
[14] "   history_nausea:\t     f, t."                                       
[15] "   history_noise:\t     f, t."                                        
[16] "   history_recruitment:\t     f, t."                                  
[17] "   history_ringing:\t     f, t."                                      
[18] "   history_roaring:\t     f, t."                                      
[19] "   history_vomiting:\t     f, t."                                     
[20] "   late_wave_poor:\t     f, t."                                       
[21] "   m_at_2k:\t\t     f, t."                                            
[22] "   m_cond_lt_1k:\t     f, t."                                         
[23] "   m_gt_1k:\t\t     f, t."                                            
[24] "   m_m_gt_2k:\t\t     f, t."                                          
[25] "   m_m_sn:\t\t     f, t."                                             
[26] "   m_m_sn_gt_1k:\t     f, t."                                         
[27] "   m_m_sn_gt_2k:\t     f, t."                                         
[28] "   m_m_sn_gt_500:\t     f, t."                                        
[29] "   m_p_sn_gt_2k:\t     f, t."                                         
[30] "   m_s_gt_500:\t\t     f, t."                                         
[31] "   m_s_sn:\t\t     f, t."                                             
[32] "   m_s_sn_gt_1k:\t     f, t."                                         
[33] "   m_s_sn_gt_2k:\t     f, t."                                         
[34] "   m_s_sn_gt_3k:\t     f, t."                                         
[35] "   m_s_sn_gt_4k:\t     f, t."                                         
[36] "   m_sn_2_3k:\t\t     f, t."                                          
[37] "   m_sn_gt_1k:\t\t     f, t."                                         
[38] "   m_sn_gt_2k:\t\t     f, t."                                         
[39] "   m_sn_gt_3k:\t\t     f, t."                                         
[40] "   m_sn_gt_4k:\t\t     f, t."                                         
[41] "   m_sn_gt_500:\t\t     f, t."                                        
[42] "   m_sn_gt_6k:\t\t     f, t."                                         
[43] "   m_sn_lt_1k:\t\t     f, t. "                                        
[44] "   m_sn_lt_2k:\t\t     f, t."                                         
[45] "   m_sn_lt_3k:\t\t     f, t."                                         
[46] "   middle_wave_poor:\t     f, t."                                     
[47] "   mod_gt_4k:\t\t     f, t."                                          
[48] "   mod_mixed:\t\t     f, t."                                          
[49] "   mod_s_mixed:\t\t     f, t."                                        
[50] "   mod_s_sn_gt_500:\t     f, t."                                      
[51] "   mod_sn:\t\t     f, t."                                             
[52] "   mod_sn_gt_1k:\t     f, t."                                         
[53] "   mod_sn_gt_2k:\t     f, t."                                         
[54] "   mod_sn_gt_3k:\t     f, t."                                         
[55] "   mod_sn_gt_4k:\t     f, t."                                         
[56] "   mod_sn_gt_500:\t     f, t."                                        
[57] "   notch_4k:\t\t     f, t."                                           
[58] "   notch_at_4k:\t\t     f, t."                                        
[59] "   o_ar_c():\t\t     normal,elevated,absent."                         
[60] "   o_ar_u():\t\t     normal,absent,elevated."                         
[61] "   s_sn_gt_1k:\t\t     f, t."                                         
[62] "   s_sn_gt_2k:\t\t     f, t."                                         
[63] "   s_sn_gt_4k:\t\t     f, t."                                         
[64] "   speech():\t\t     normal,good,very_good,very_poor,poor,unmeasured."
[65] "   static_normal:\t     f, t."                                        
[66] "   tymp():\t\t     a,as,b,ad,c."                                      
[67] "   viith_nerve_signs:        f, t."                                   
[68] "   wave_V_delayed:\t     f, t."                                       
[69] "   waveform_ItoV_prolonged:  f, t."                                   </code></pre>
</div>
</div>
<p>Observe: a name line consists two parts, name: valid values. The part before : is the name.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>names <span class="ot">&lt;-</span> <span class="fu">str_split_fixed</span>(names, <span class="st">":"</span>, <span class="dv">2</span>) <span class="co">#split on regex pattern ":", this function returns a matrix</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>names</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      [,1]                        
 [1,] "   age_gt_60"              
 [2,] "   air()"                  
 [3,] "   airBoneGap"             
 [4,] "   ar_c()"                 
 [5,] "   ar_u()"                 
 [6,] "   bone()"                 
 [7,] "   boneAbnormal"           
 [8,] "   bser()"                 
 [9,] "   history_buzzing"        
[10,] "   history_dizziness"      
[11,] "   history_fluctuating"    
[12,] "   history_fullness"       
[13,] "   history_heredity"       
[14,] "   history_nausea"         
[15,] "   history_noise"          
[16,] "   history_recruitment"    
[17,] "   history_ringing"        
[18,] "   history_roaring"        
[19,] "   history_vomiting"       
[20,] "   late_wave_poor"         
[21,] "   m_at_2k"                
[22,] "   m_cond_lt_1k"           
[23,] "   m_gt_1k"                
[24,] "   m_m_gt_2k"              
[25,] "   m_m_sn"                 
[26,] "   m_m_sn_gt_1k"           
[27,] "   m_m_sn_gt_2k"           
[28,] "   m_m_sn_gt_500"          
[29,] "   m_p_sn_gt_2k"           
[30,] "   m_s_gt_500"             
[31,] "   m_s_sn"                 
[32,] "   m_s_sn_gt_1k"           
[33,] "   m_s_sn_gt_2k"           
[34,] "   m_s_sn_gt_3k"           
[35,] "   m_s_sn_gt_4k"           
[36,] "   m_sn_2_3k"              
[37,] "   m_sn_gt_1k"             
[38,] "   m_sn_gt_2k"             
[39,] "   m_sn_gt_3k"             
[40,] "   m_sn_gt_4k"             
[41,] "   m_sn_gt_500"            
[42,] "   m_sn_gt_6k"             
[43,] "   m_sn_lt_1k"             
[44,] "   m_sn_lt_2k"             
[45,] "   m_sn_lt_3k"             
[46,] "   middle_wave_poor"       
[47,] "   mod_gt_4k"              
[48,] "   mod_mixed"              
[49,] "   mod_s_mixed"            
[50,] "   mod_s_sn_gt_500"        
[51,] "   mod_sn"                 
[52,] "   mod_sn_gt_1k"           
[53,] "   mod_sn_gt_2k"           
[54,] "   mod_sn_gt_3k"           
[55,] "   mod_sn_gt_4k"           
[56,] "   mod_sn_gt_500"          
[57,] "   notch_4k"               
[58,] "   notch_at_4k"            
[59,] "   o_ar_c()"               
[60,] "   o_ar_u()"               
[61,] "   s_sn_gt_1k"             
[62,] "   s_sn_gt_2k"             
[63,] "   s_sn_gt_4k"             
[64,] "   speech()"               
[65,] "   static_normal"          
[66,] "   tymp()"                 
[67,] "   viith_nerve_signs"      
[68,] "   wave_V_delayed"         
[69,] "   waveform_ItoV_prolonged"
      [,2]                                                       
 [1,] "\t\t     f, t."                                           
 [2,] "\t\t     mild,moderate,severe,normal,profound."           
 [3,] "\t\t     f, t."                                           
 [4,] "\t\t     normal,elevated,absent."                         
 [5,] "\t\t     normal,absent,elevated."                         
 [6,] "\t\t     mild,moderate,normal,unmeasured."                
 [7,] "\t     f, t."                                             
 [8,] "\t\t     normal,degraded."                                
 [9,] "\t     f, t."                                             
[10,] "\t     f, t."                                             
[11,] "\t     f, t."                                             
[12,] "\t     f, t."                                             
[13,] "\t     f, t."                                             
[14,] "\t     f, t."                                             
[15,] "\t     f, t."                                             
[16,] "\t     f, t."                                             
[17,] "\t     f, t."                                             
[18,] "\t     f, t."                                             
[19,] "\t     f, t."                                             
[20,] "\t     f, t."                                             
[21,] "\t\t     f, t."                                           
[22,] "\t     f, t."                                             
[23,] "\t\t     f, t."                                           
[24,] "\t\t     f, t."                                           
[25,] "\t\t     f, t."                                           
[26,] "\t     f, t."                                             
[27,] "\t     f, t."                                             
[28,] "\t     f, t."                                             
[29,] "\t     f, t."                                             
[30,] "\t\t     f, t."                                           
[31,] "\t\t     f, t."                                           
[32,] "\t     f, t."                                             
[33,] "\t     f, t."                                             
[34,] "\t     f, t."                                             
[35,] "\t     f, t."                                             
[36,] "\t\t     f, t."                                           
[37,] "\t\t     f, t."                                           
[38,] "\t\t     f, t."                                           
[39,] "\t\t     f, t."                                           
[40,] "\t\t     f, t."                                           
[41,] "\t\t     f, t."                                           
[42,] "\t\t     f, t."                                           
[43,] "\t\t     f, t. "                                          
[44,] "\t\t     f, t."                                           
[45,] "\t\t     f, t."                                           
[46,] "\t     f, t."                                             
[47,] "\t\t     f, t."                                           
[48,] "\t\t     f, t."                                           
[49,] "\t\t     f, t."                                           
[50,] "\t     f, t."                                             
[51,] "\t\t     f, t."                                           
[52,] "\t     f, t."                                             
[53,] "\t     f, t."                                             
[54,] "\t     f, t."                                             
[55,] "\t     f, t."                                             
[56,] "\t     f, t."                                             
[57,] "\t\t     f, t."                                           
[58,] "\t\t     f, t."                                           
[59,] "\t\t     normal,elevated,absent."                         
[60,] "\t\t     normal,absent,elevated."                         
[61,] "\t\t     f, t."                                           
[62,] "\t\t     f, t."                                           
[63,] "\t\t     f, t."                                           
[64,] "\t\t     normal,good,very_good,very_poor,poor,unmeasured."
[65,] "\t     f, t."                                             
[66,] "\t\t     a,as,b,ad,c."                                    
[67,] "        f, t."                                            
[68,] "\t     f, t."                                             
[69,] "  f, t."                                                  </code></pre>
</div>
</div>
<p>Taking the first column, which contains names:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>names <span class="ot">&lt;-</span> names[,<span class="dv">1</span>]</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>names</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "   age_gt_60"               "   air()"                  
 [3] "   airBoneGap"              "   ar_c()"                 
 [5] "   ar_u()"                  "   bone()"                 
 [7] "   boneAbnormal"            "   bser()"                 
 [9] "   history_buzzing"         "   history_dizziness"      
[11] "   history_fluctuating"     "   history_fullness"       
[13] "   history_heredity"        "   history_nausea"         
[15] "   history_noise"           "   history_recruitment"    
[17] "   history_ringing"         "   history_roaring"        
[19] "   history_vomiting"        "   late_wave_poor"         
[21] "   m_at_2k"                 "   m_cond_lt_1k"           
[23] "   m_gt_1k"                 "   m_m_gt_2k"              
[25] "   m_m_sn"                  "   m_m_sn_gt_1k"           
[27] "   m_m_sn_gt_2k"            "   m_m_sn_gt_500"          
[29] "   m_p_sn_gt_2k"            "   m_s_gt_500"             
[31] "   m_s_sn"                  "   m_s_sn_gt_1k"           
[33] "   m_s_sn_gt_2k"            "   m_s_sn_gt_3k"           
[35] "   m_s_sn_gt_4k"            "   m_sn_2_3k"              
[37] "   m_sn_gt_1k"              "   m_sn_gt_2k"             
[39] "   m_sn_gt_3k"              "   m_sn_gt_4k"             
[41] "   m_sn_gt_500"             "   m_sn_gt_6k"             
[43] "   m_sn_lt_1k"              "   m_sn_lt_2k"             
[45] "   m_sn_lt_3k"              "   middle_wave_poor"       
[47] "   mod_gt_4k"               "   mod_mixed"              
[49] "   mod_s_mixed"             "   mod_s_sn_gt_500"        
[51] "   mod_sn"                  "   mod_sn_gt_1k"           
[53] "   mod_sn_gt_2k"            "   mod_sn_gt_3k"           
[55] "   mod_sn_gt_4k"            "   mod_sn_gt_500"          
[57] "   notch_4k"                "   notch_at_4k"            
[59] "   o_ar_c()"                "   o_ar_u()"               
[61] "   s_sn_gt_1k"              "   s_sn_gt_2k"             
[63] "   s_sn_gt_4k"              "   speech()"               
[65] "   static_normal"           "   tymp()"                 
[67] "   viith_nerve_signs"       "   wave_V_delayed"         
[69] "   waveform_ItoV_prolonged"</code></pre>
</div>
</div>
<p>Clean up the names: trim spaces, remove ():</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>names <span class="ot">&lt;-</span><span class="fu">str_trim</span>(names) <span class="sc">|&gt;</span> <span class="fu">str_replace_all</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">(|</span><span class="sc">\\</span><span class="st">)"</span>, <span class="st">""</span>) </span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>names</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "age_gt_60"               "air"                    
 [3] "airBoneGap"              "ar_c"                   
 [5] "ar_u"                    "bone"                   
 [7] "boneAbnormal"            "bser"                   
 [9] "history_buzzing"         "history_dizziness"      
[11] "history_fluctuating"     "history_fullness"       
[13] "history_heredity"        "history_nausea"         
[15] "history_noise"           "history_recruitment"    
[17] "history_ringing"         "history_roaring"        
[19] "history_vomiting"        "late_wave_poor"         
[21] "m_at_2k"                 "m_cond_lt_1k"           
[23] "m_gt_1k"                 "m_m_gt_2k"              
[25] "m_m_sn"                  "m_m_sn_gt_1k"           
[27] "m_m_sn_gt_2k"            "m_m_sn_gt_500"          
[29] "m_p_sn_gt_2k"            "m_s_gt_500"             
[31] "m_s_sn"                  "m_s_sn_gt_1k"           
[33] "m_s_sn_gt_2k"            "m_s_sn_gt_3k"           
[35] "m_s_sn_gt_4k"            "m_sn_2_3k"              
[37] "m_sn_gt_1k"              "m_sn_gt_2k"             
[39] "m_sn_gt_3k"              "m_sn_gt_4k"             
[41] "m_sn_gt_500"             "m_sn_gt_6k"             
[43] "m_sn_lt_1k"              "m_sn_lt_2k"             
[45] "m_sn_lt_3k"              "middle_wave_poor"       
[47] "mod_gt_4k"               "mod_mixed"              
[49] "mod_s_mixed"             "mod_s_sn_gt_500"        
[51] "mod_sn"                  "mod_sn_gt_1k"           
[53] "mod_sn_gt_2k"            "mod_sn_gt_3k"           
[55] "mod_sn_gt_4k"            "mod_sn_gt_500"          
[57] "notch_4k"                "notch_at_4k"            
[59] "o_ar_c"                  "o_ar_u"                 
[61] "s_sn_gt_1k"              "s_sn_gt_2k"             
[63] "s_sn_gt_4k"              "speech"                 
[65] "static_normal"           "tymp"                   
[67] "viith_nerve_signs"       "wave_V_delayed"         
[69] "waveform_ItoV_prolonged"</code></pre>
</div>
</div>
<p>Finally, put the columns to the data:</p>
<p>Note: data has 71 rows but we only has 69 names. The last two columns in data are identifier and class labels. So we will put the 69 names to the first 69 columns.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(data)[<span class="dv">1</span><span class="sc">:</span><span class="dv">69</span>] <span class="ot">&lt;-</span> names</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 200 × 71
   age_gt_60 air      airBoneGap ar_c     ar_u   bone  boneAbnormal bser 
   &lt;lgl&gt;     &lt;chr&gt;    &lt;lgl&gt;      &lt;chr&gt;    &lt;chr&gt;  &lt;chr&gt; &lt;lgl&gt;        &lt;chr&gt;
 1 FALSE     mild     FALSE      normal   normal &lt;NA&gt;  TRUE         &lt;NA&gt; 
 2 FALSE     moderate FALSE      normal   normal &lt;NA&gt;  TRUE         &lt;NA&gt; 
 3 TRUE      mild     TRUE       &lt;NA&gt;     absent mild  TRUE         &lt;NA&gt; 
 4 TRUE      mild     TRUE       &lt;NA&gt;     absent mild  FALSE        &lt;NA&gt; 
 5 TRUE      mild     FALSE      normal   normal mild  TRUE         &lt;NA&gt; 
 6 TRUE      mild     FALSE      normal   normal mild  TRUE         &lt;NA&gt; 
 7 FALSE     mild     FALSE      normal   normal mild  TRUE         &lt;NA&gt; 
 8 FALSE     mild     FALSE      normal   normal mild  TRUE         &lt;NA&gt; 
 9 FALSE     severe   FALSE      &lt;NA&gt;     &lt;NA&gt;   &lt;NA&gt;  TRUE         &lt;NA&gt; 
10 TRUE      mild     FALSE      elevated absent mild  TRUE         &lt;NA&gt; 
# ℹ 190 more rows
# ℹ 63 more variables: history_buzzing &lt;lgl&gt;, history_dizziness &lt;lgl&gt;,
#   history_fluctuating &lt;lgl&gt;, history_fullness &lt;lgl&gt;, history_heredity &lt;lgl&gt;,
#   history_nausea &lt;lgl&gt;, history_noise &lt;lgl&gt;, history_recruitment &lt;lgl&gt;,
#   history_ringing &lt;lgl&gt;, history_roaring &lt;lgl&gt;, history_vomiting &lt;lgl&gt;,
#   late_wave_poor &lt;lgl&gt;, m_at_2k &lt;lgl&gt;, m_cond_lt_1k &lt;lgl&gt;, m_gt_1k &lt;lgl&gt;,
#   m_m_gt_2k &lt;lgl&gt;, m_m_sn &lt;lgl&gt;, m_m_sn_gt_1k &lt;lgl&gt;, m_m_sn_gt_2k &lt;lgl&gt;, …</code></pre>
</div>
</div>
<p>Rename the last two columns:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(data)[<span class="dv">70</span><span class="sc">:</span><span class="dv">71</span>] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"id"</span>, <span class="st">"class"</span>)</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 200 × 71
   age_gt_60 air      airBoneGap ar_c     ar_u   bone  boneAbnormal bser 
   &lt;lgl&gt;     &lt;chr&gt;    &lt;lgl&gt;      &lt;chr&gt;    &lt;chr&gt;  &lt;chr&gt; &lt;lgl&gt;        &lt;chr&gt;
 1 FALSE     mild     FALSE      normal   normal &lt;NA&gt;  TRUE         &lt;NA&gt; 
 2 FALSE     moderate FALSE      normal   normal &lt;NA&gt;  TRUE         &lt;NA&gt; 
 3 TRUE      mild     TRUE       &lt;NA&gt;     absent mild  TRUE         &lt;NA&gt; 
 4 TRUE      mild     TRUE       &lt;NA&gt;     absent mild  FALSE        &lt;NA&gt; 
 5 TRUE      mild     FALSE      normal   normal mild  TRUE         &lt;NA&gt; 
 6 TRUE      mild     FALSE      normal   normal mild  TRUE         &lt;NA&gt; 
 7 FALSE     mild     FALSE      normal   normal mild  TRUE         &lt;NA&gt; 
 8 FALSE     mild     FALSE      normal   normal mild  TRUE         &lt;NA&gt; 
 9 FALSE     severe   FALSE      &lt;NA&gt;     &lt;NA&gt;   &lt;NA&gt;  TRUE         &lt;NA&gt; 
10 TRUE      mild     FALSE      elevated absent mild  TRUE         &lt;NA&gt; 
# ℹ 190 more rows
# ℹ 63 more variables: history_buzzing &lt;lgl&gt;, history_dizziness &lt;lgl&gt;,
#   history_fluctuating &lt;lgl&gt;, history_fullness &lt;lgl&gt;, history_heredity &lt;lgl&gt;,
#   history_nausea &lt;lgl&gt;, history_noise &lt;lgl&gt;, history_recruitment &lt;lgl&gt;,
#   history_ringing &lt;lgl&gt;, history_roaring &lt;lgl&gt;, history_vomiting &lt;lgl&gt;,
#   late_wave_poor &lt;lgl&gt;, m_at_2k &lt;lgl&gt;, m_cond_lt_1k &lt;lgl&gt;, m_gt_1k &lt;lgl&gt;,
#   m_m_gt_2k &lt;lgl&gt;, m_m_sn &lt;lgl&gt;, m_m_sn_gt_1k &lt;lgl&gt;, m_m_sn_gt_2k &lt;lgl&gt;, …</code></pre>
</div>
</div>
</section>
<section id="dealing-with-unknown-values" class="level2">
<h2 class="anchored" data-anchor-id="dealing-with-unknown-values">Dealing with unknown values</h2>
<p>Remove observations or columns with many NAs:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>missing.value.rows <span class="ot">&lt;-</span> data <span class="sc">|&gt;</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">complete.cases</span>(data))</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>missing.value.rows</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 196 × 71
   age_gt_60 air      airBoneGap ar_c     ar_u   bone  boneAbnormal bser 
   &lt;lgl&gt;     &lt;chr&gt;    &lt;lgl&gt;      &lt;chr&gt;    &lt;chr&gt;  &lt;chr&gt; &lt;lgl&gt;        &lt;chr&gt;
 1 FALSE     mild     FALSE      normal   normal &lt;NA&gt;  TRUE         &lt;NA&gt; 
 2 FALSE     moderate FALSE      normal   normal &lt;NA&gt;  TRUE         &lt;NA&gt; 
 3 TRUE      mild     TRUE       &lt;NA&gt;     absent mild  TRUE         &lt;NA&gt; 
 4 TRUE      mild     TRUE       &lt;NA&gt;     absent mild  FALSE        &lt;NA&gt; 
 5 TRUE      mild     FALSE      normal   normal mild  TRUE         &lt;NA&gt; 
 6 TRUE      mild     FALSE      normal   normal mild  TRUE         &lt;NA&gt; 
 7 FALSE     mild     FALSE      normal   normal mild  TRUE         &lt;NA&gt; 
 8 FALSE     mild     FALSE      normal   normal mild  TRUE         &lt;NA&gt; 
 9 FALSE     severe   FALSE      &lt;NA&gt;     &lt;NA&gt;   &lt;NA&gt;  TRUE         &lt;NA&gt; 
10 TRUE      mild     FALSE      elevated absent mild  TRUE         &lt;NA&gt; 
# ℹ 186 more rows
# ℹ 63 more variables: history_buzzing &lt;lgl&gt;, history_dizziness &lt;lgl&gt;,
#   history_fluctuating &lt;lgl&gt;, history_fullness &lt;lgl&gt;, history_heredity &lt;lgl&gt;,
#   history_nausea &lt;lgl&gt;, history_noise &lt;lgl&gt;, history_recruitment &lt;lgl&gt;,
#   history_ringing &lt;lgl&gt;, history_roaring &lt;lgl&gt;, history_vomiting &lt;lgl&gt;,
#   late_wave_poor &lt;lgl&gt;, m_at_2k &lt;lgl&gt;, m_cond_lt_1k &lt;lgl&gt;, m_gt_1k &lt;lgl&gt;,
#   m_m_gt_2k &lt;lgl&gt;, m_m_sn &lt;lgl&gt;, m_m_sn_gt_1k &lt;lgl&gt;, m_m_sn_gt_2k &lt;lgl&gt;, …</code></pre>
</div>
</div>
<p>196 out of 200 rows contain an NA!</p>
<p>How many NAs in each row? Apply a temporary function to the rows (“1”, if to columns use “2”) of data. This function counts the number of NAs in a row. If is.na(x) is TRUE (equivalent to 1), the sum of the booleans is then the count.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">na_count =</span> <span class="fu">rowSums</span>(<span class="fu">is.na</span>(data)))</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 200 × 72
   age_gt_60 air      airBoneGap ar_c     ar_u   bone  boneAbnormal bser 
   &lt;lgl&gt;     &lt;chr&gt;    &lt;lgl&gt;      &lt;chr&gt;    &lt;chr&gt;  &lt;chr&gt; &lt;lgl&gt;        &lt;chr&gt;
 1 FALSE     mild     FALSE      normal   normal &lt;NA&gt;  TRUE         &lt;NA&gt; 
 2 FALSE     moderate FALSE      normal   normal &lt;NA&gt;  TRUE         &lt;NA&gt; 
 3 TRUE      mild     TRUE       &lt;NA&gt;     absent mild  TRUE         &lt;NA&gt; 
 4 TRUE      mild     TRUE       &lt;NA&gt;     absent mild  FALSE        &lt;NA&gt; 
 5 TRUE      mild     FALSE      normal   normal mild  TRUE         &lt;NA&gt; 
 6 TRUE      mild     FALSE      normal   normal mild  TRUE         &lt;NA&gt; 
 7 FALSE     mild     FALSE      normal   normal mild  TRUE         &lt;NA&gt; 
 8 FALSE     mild     FALSE      normal   normal mild  TRUE         &lt;NA&gt; 
 9 FALSE     severe   FALSE      &lt;NA&gt;     &lt;NA&gt;   &lt;NA&gt;  TRUE         &lt;NA&gt; 
10 TRUE      mild     FALSE      elevated absent mild  TRUE         &lt;NA&gt; 
# ℹ 190 more rows
# ℹ 64 more variables: history_buzzing &lt;lgl&gt;, history_dizziness &lt;lgl&gt;,
#   history_fluctuating &lt;lgl&gt;, history_fullness &lt;lgl&gt;, history_heredity &lt;lgl&gt;,
#   history_nausea &lt;lgl&gt;, history_noise &lt;lgl&gt;, history_recruitment &lt;lgl&gt;,
#   history_ringing &lt;lgl&gt;, history_roaring &lt;lgl&gt;, history_vomiting &lt;lgl&gt;,
#   late_wave_poor &lt;lgl&gt;, m_at_2k &lt;lgl&gt;, m_cond_lt_1k &lt;lgl&gt;, m_gt_1k &lt;lgl&gt;,
#   m_m_gt_2k &lt;lgl&gt;, m_m_sn &lt;lgl&gt;, m_m_sn_gt_1k &lt;lgl&gt;, m_m_sn_gt_2k &lt;lgl&gt;, …</code></pre>
</div>
</div>
<p>Maximum missing values in a row is 7, out of 69 dimensions, so they are not too bad.</p>
<p>Examine columns: how many NAs in each variable/column?</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>data <span class="sc">|&gt;</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), <span class="sc">~</span><span class="fu">sum</span>(<span class="fu">is.na</span>(.)), <span class="at">.names =</span> <span class="st">"na_{.col}"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">"column_name"</span>, <span class="at">values_to =</span> <span class="st">"na_count"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(na_count)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 72 × 2
   column_name            na_count
   &lt;chr&gt;                     &lt;int&gt;
 1 na_age_gt_60                  0
 2 na_air                        0
 3 na_airBoneGap                 0
 4 na_boneAbnormal               0
 5 na_history_buzzing            0
 6 na_history_dizziness          0
 7 na_history_fluctuating        0
 8 na_history_fullness           0
 9 na_history_heredity           0
10 na_history_nausea             0
# ℹ 62 more rows</code></pre>
</div>
</div>
<p>bser variable has 196 NAs. If this variable is considered not useful, given some domain knowledge, we can remove it from the data. From View, I can see bser is the 8th column:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>data.bser.removed <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="dv">8</span>) <span class="sc">%&gt;%</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), <span class="sc">~</span><span class="fu">sum</span>(<span class="fu">is.na</span>(.)), <span class="at">.names =</span> <span class="st">"na_{.col}"</span>))</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>data.bser.removed</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 71
  na_age_gt_60 na_air na_airBoneGap na_ar_c na_ar_u na_bone na_boneAbnormal
         &lt;int&gt;  &lt;int&gt;         &lt;int&gt;   &lt;int&gt;   &lt;int&gt;   &lt;int&gt;           &lt;int&gt;
1            0      0             0       4       3      75               0
# ℹ 64 more variables: na_history_buzzing &lt;int&gt;, na_history_dizziness &lt;int&gt;,
#   na_history_fluctuating &lt;int&gt;, na_history_fullness &lt;int&gt;,
#   na_history_heredity &lt;int&gt;, na_history_nausea &lt;int&gt;, na_history_noise &lt;int&gt;,
#   na_history_recruitment &lt;int&gt;, na_history_ringing &lt;int&gt;,
#   na_history_roaring &lt;int&gt;, na_history_vomiting &lt;int&gt;,
#   na_late_wave_poor &lt;int&gt;, na_m_at_2k &lt;int&gt;, na_m_cond_lt_1k &lt;int&gt;,
#   na_m_gt_1k &lt;int&gt;, na_m_m_gt_2k &lt;int&gt;, na_m_m_sn &lt;int&gt;, …</code></pre>
</div>
</div>
<p>matches function can also help you find the index of a colname given its name:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">matches</span>(<span class="st">"bser"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="mistaken-characters" class="level3">
<h3 class="anchored" data-anchor-id="mistaken-characters">Mistaken characters</h3>
<p>R decides the data type based on what is given, sometimes, R’s decision may not be what you meant. In the example below, because of a missing value ?, R makes all other values in a vector ‘character’. Parse_integer can be used to fix this problem.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>mistaken <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="st">"?"</span>)</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(mistaken)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "character"</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>fixed <span class="ot">&lt;-</span> <span class="fu">parse_integer</span>(mistaken, <span class="at">na =</span> <span class="st">'?'</span>)</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>fixed</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  2  3  4 NA</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(fixed)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "integer"</code></pre>
</div>
</div>
</section>
<section id="filling-unknowns-with-most-frequent-values" class="level3">
<h3 class="anchored" data-anchor-id="filling-unknowns-with-most-frequent-values">Filling unknowns with most frequent values</h3>
<p>Always take cautions when you modify the original data.</p>
<p><strong>Modifications must be well documented</strong> (so others can repeat your analysis) and well justified!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(<span class="st">"DMwR2"</span>))</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">install.packages</span>(<span class="st">"DMwR2"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: DMwR2</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Registered S3 method overwritten by 'quantmod':
  method            from
  as.zoo.data.frame zoo </code></pre>
</div>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DMwR2)</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(algae, <span class="at">package =</span> <span class="st">"DMwR2"</span>)</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>algae[<span class="dv">48</span>,]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 18
  season size  speed  mxPH  mnO2    Cl   NO3   NH4  oPO4   PO4  Chla    a1    a2
  &lt;fct&gt;  &lt;fct&gt; &lt;fct&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 winter small low      NA  12.6     9  0.23    10     5     6   1.1  35.5     0
# ℹ 5 more variables: a3 &lt;dbl&gt;, a4 &lt;dbl&gt;, a5 &lt;dbl&gt;, a6 &lt;dbl&gt;, a7 &lt;dbl&gt;</code></pre>
</div>
</div>
<p>mxPH is unknown. What should we replace it with? Mean, median or mode. It depends on the distribution of the plot. If it is normally ditributed, we can use mean, otherwise median is a better option.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot a QQ plot of mxPH</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(<span class="st">"car"</span>))</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">install.packages</span>(<span class="st">"car"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: car</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: carData</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'car'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:purrr':

    some</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:dplyr':

    recode</code></pre>
</div>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(car)</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(algae, <span class="fu">aes</span>(<span class="at">sample =</span> mxPH)) <span class="sc">+</span></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_qq_band</span>() <span class="sc">+</span></span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_qq_point</span>() <span class="sc">+</span></span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stat_qq_line</span>(<span class="at">color =</span> <span class="st">"red"</span>, <span class="at">method =</span> <span class="st">"identity"</span>, <span class="at">intercept =</span> <span class="sc">-</span><span class="dv">2</span>, <span class="at">slope =</span> <span class="dv">1</span>) <span class="sc">+</span>  </span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Normal QQ plot of mxPH"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in stat_qq_line(color = "red", method = "identity", intercept = -2, :
Ignoring unknown parameters: `method`, `intercept`, and `slope`</code></pre>
</div>
<div class="cell-output-display">
<p><img src="r-python-exercise2_files/figure-html/unnamed-chunk-36-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The straight line fits the data pretty well so mxPH is normal, use mean to fill the unknown.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>algae <span class="ot">&lt;-</span> algae <span class="sc">|&gt;</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mxPH =</span> <span class="fu">ifelse</span>(<span class="fu">row_number</span>() <span class="sc">==</span> <span class="dv">48</span>, <span class="fu">mean</span>(mxPH, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), mxPH))</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>algae</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 200 × 18
   season size  speed   mxPH  mnO2    Cl    NO3   NH4  oPO4   PO4  Chla    a1
   &lt;fct&gt;  &lt;fct&gt; &lt;fct&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
 1 winter small medium  8      9.8  60.8  6.24  578   105   170   50      0  
 2 spring small medium  8.35   8    57.8  1.29  370   429.  559.   1.3    1.4
 3 autumn small medium  8.1   11.4  40.0  5.33  347.  126.  187.  15.6    3.3
 4 spring small medium  8.07   4.8  77.4  2.30   98.2  61.2 139.   1.4    3.1
 5 autumn small medium  8.06   9    55.4 10.4   234.   58.2  97.6 10.5    9.2
 6 winter small high    8.25  13.1  65.8  9.25  430    18.2  56.7 28.4   15.1
 7 summer small high    8.15  10.3  73.2  1.54  110    61.2 112.   3.2    2.4
 8 autumn small high    8.05  10.6  59.1  4.99  206.   44.7  77.4  6.9   18.2
 9 winter small medium  8.7    3.4  22.0  0.886 103.   36.3  71    5.54  25.4
10 winter small high    7.93   9.9   8    1.39    5.8  27.2  46.6  0.8   17  
# ℹ 190 more rows
# ℹ 6 more variables: a2 &lt;dbl&gt;, a3 &lt;dbl&gt;, a4 &lt;dbl&gt;, a5 &lt;dbl&gt;, a6 &lt;dbl&gt;,
#   a7 &lt;dbl&gt;</code></pre>
</div>
</div>
<p>Similarly, let’s check for Chla(attribute)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(algae, <span class="fu">aes</span>(<span class="at">sample =</span> Chla)) <span class="sc">+</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_qq_band</span>() <span class="sc">+</span></span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_qq_point</span>() <span class="sc">+</span></span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stat_qq_line</span>(<span class="at">color =</span> <span class="st">"red"</span>, <span class="at">method =</span> <span class="st">"identity"</span>, <span class="at">intercept =</span> <span class="sc">-</span><span class="dv">2</span>, <span class="at">slope =</span> <span class="dv">1</span>) <span class="sc">+</span>  </span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Normal QQ plot of Chla"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in stat_qq_line(color = "red", method = "identity", intercept = -2, :
Ignoring unknown parameters: `method`, `intercept`, and `slope`</code></pre>
</div>
<div class="cell-output-display">
<p><img src="r-python-exercise2_files/figure-html/unnamed-chunk-38-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="fu">median</span>(algae<span class="sc">$</span>Chla, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 5.475</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(algae<span class="sc">$</span>Chla, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 13.9712</code></pre>
</div>
</div>
<p>Obviously, the mean is not a representative value for Chla. For this we will use median to fill all missing values in this attribute, instead of doing it one value at a time:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>algae <span class="ot">&lt;-</span> algae <span class="sc">|&gt;</span></span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Chla =</span> <span class="fu">if_else</span>(<span class="fu">is.na</span>(Chla), <span class="fu">median</span>(Chla, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), Chla))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="filling-unknowns-using-linear-regression" class="level3">
<h3 class="anchored" data-anchor-id="filling-unknowns-using-linear-regression">Filling unknowns using linear regression</h3>
<p>This method is used when two variables are highly correlated. One value of variable A can be used to predict the value for variable B using the linear regression model.</p>
<p>First let’s see what variables in algae are highly correlated:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>algae_numeric <span class="ot">&lt;-</span> algae[, <span class="dv">4</span><span class="sc">:</span><span class="dv">18</span>] <span class="sc">%&gt;%</span></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>()  <span class="co"># Removes rows with NA values</span></span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a>cor_matrix <span class="ot">&lt;-</span> algae_numeric <span class="sc">|&gt;</span> <span class="fu">correlate</span>() <span class="sc">|&gt;</span> <span class="fu">plot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="r-python-exercise2_files/figure-html/unnamed-chunk-42-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>cor_matrix</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="r-python-exercise2_files/figure-html/unnamed-chunk-43-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="co"># study only the numerical variables (4-18) and use only the complete observations -- obs with NAs are not used. symnum() makes the correlation matrix more readable</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can see from the matrix, PO4 and oPO4 are correct with a confidence level of 90%.</p>
<p>Next, we find the linear model between PO4 and oPO4:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>algae <span class="ot">&lt;-</span> algae <span class="sc">%&gt;%</span></span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">rowSums</span>(<span class="fu">is.na</span>(.)) <span class="sc">/</span> <span class="fu">ncol</span>(.) <span class="sc">&lt;</span> <span class="fl">0.2</span>)<span class="co">#this is a method provided that selects the observations with 20% or move values as NAs. </span></span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a>m <span class="ot">=</span> <span class="fu">lm</span>(PO4 <span class="sc">~</span> oPO4, <span class="at">data =</span> algae)</span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(<span class="at">formula =</span> PO4 <span class="sc">~</span> oPO4, <span class="at">data =</span> algae)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = PO4 ~ oPO4, data = algae)

Coefficients:
(Intercept)         oPO4  
     42.897        1.293  </code></pre>
</div>
</div>
<p>Check the model, is it good? See http://r-statistics.co/Linear-Regression.html</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>m <span class="sc">|&gt;</span> </span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = PO4 ~ oPO4, data = algae)

Residuals:
    Min      1Q  Median      3Q     Max 
-110.12  -36.34  -12.68   23.26  216.98 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)   42.897      4.808   8.922 3.34e-16 ***
oPO4           1.293      0.041  31.535  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 52.37 on 195 degrees of freedom
  (1 observation deleted due to missingness)
Multiple R-squared:  0.8361,    Adjusted R-squared:  0.8352 
F-statistic: 994.5 on 1 and 195 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p>Or use..</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>m <span class="sc">|&gt;</span> </span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>() <span class="sc">|&gt;</span> </span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 5
  term        estimate std.error statistic  p.value
  &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
1 (Intercept)    42.9     4.81        8.92 3.34e-16
2 oPO4            1.29    0.0410     31.5  1.68e-78</code></pre>
</div>
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="co"># tidy creates a more readable output</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If a good model, coefficients should all be significant (reject Ho coefficience is 0), Adjusted R-squared close to 1 (0.8 is very good).</p>
<p>F-statistics p-value should be less than the significant level (typically 0.05).</p>
<p>While R-squared provides an estimate of the strength of the relationship between your model and the response variable, it does not provide a formal hypothesis test for this relationship.</p>
<p>The F-test of overall significance determines whether this relationship is statistically significant.</p>
<p>This model is good. We can also assess the fitness of the model with fitted line plot (should show the good fit), residual plot (should show residual being random).</p>
<p>This lm is PO4 = 1.293*oPO4 + 42.897</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>algae<span class="sc">$</span>PO4</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  [1] 170.000 558.750 187.057 138.700  97.580  56.667 111.750  77.434  71.000
 [10]  46.600  20.750  19.000  17.000  15.000  61.600  98.250  50.000  57.833
 [19]  61.500 771.600 586.000  18.000  40.000  27.500  11.500  44.136  13.600
 [28]      NA  45.000  19.000 142.000 304.000 130.750  47.000  23.000  84.460
 [37]   3.000   3.000 253.250 255.280 296.000 175.046 344.600 326.857  40.667
 [46]  43.500  39.000   6.000 121.000  20.812  49.333  22.900  11.800  11.818
 [55]   6.500   1.000   4.000   6.000  11.000   6.000  14.000   6.667   6.750
 [64]   7.200   6.000  10.750   2.500 351.600 313.600 279.066 152.333  58.623
 [73] 249.250 233.500 215.500 102.333 105.727 111.375 108.000  56.667  60.000
 [82] 104.000  69.930 214.000 254.600 169.001 607.167 624.733 303.333 391.750
 [91] 265.250 232.833 244.000 218.000 138.500 239.000 235.667 205.875 211.667
[100] 186.500 154.125 183.667 292.625 285.714 201.778 275.143 124.200 141.833
[109] 132.546  17.333  26.000  16.662 102.571  86.997  10.111  18.293  13.200
[118] 432.909 320.400 287.000 262.727 222.286 122.000 127.222  89.625 284.000
[127] 277.333 177.625  72.900  82.444  66.750 173.750 317.000  84.000 213.000
[136]  88.500 115.000  98.143 143.750 197.143  35.200  23.485 200.231 147.833
[145] 276.000 123.333  75.207 116.200 188.667  72.696 116.200  34.000  76.333
[154]  58.374 361.000 236.000 125.800  54.916  75.333 186.000 252.500 269.667
[163]  46.438  85.000 171.272 232.900 146.452 246.667 219.909 272.222 388.167
[172] 167.900 137.778 194.100 221.278  21.300  11.000  14.354   7.000   6.200
[181]   7.654  16.000  56.091  52.875 228.364  85.400  87.125 101.455 127.000
[190]  81.558  50.455 120.889  91.111  61.444  79.750  75.904 140.220 140.517</code></pre>
</div>
</div>
<p>PO4 for observation 28 can then be filled with predicated value using the model</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>algae <span class="ot">&lt;-</span> algae <span class="sc">%&gt;%</span></span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">PO4 =</span> <span class="fu">ifelse</span>(<span class="fu">row_number</span>() <span class="sc">==</span> <span class="dv">28</span>, <span class="fl">42.897</span> <span class="sc">+</span> <span class="fl">1.293</span> <span class="sc">*</span> oPO4, PO4))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>res <span class="ot">=</span> <span class="fu">resid</span>(m)</span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a>oPO4_reduced <span class="ot">&lt;-</span> algae <span class="sc">%&gt;%</span></span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">row_number</span>() <span class="sc">!=</span> <span class="dv">28</span>) <span class="sc">%&gt;%</span></span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(oPO4)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> <span class="fu">data.frame</span>(<span class="at">oPO4 =</span> m<span class="sc">$</span>model<span class="sc">$</span>oPO4, <span class="at">res =</span> res), <span class="fu">aes</span>(<span class="at">x =</span> oPO4, <span class="at">y =</span> res)) <span class="sc">+</span></span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"oPO4"</span>,</span>
<span id="cb100-6"><a href="#cb100-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"residuals"</span>,</span>
<span id="cb100-7"><a href="#cb100-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Residual Plot"</span></span>
<span id="cb100-8"><a href="#cb100-8" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="r-python-exercise2_files/figure-html/unnamed-chunk-51-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>If there are more PO4 cells to fill, we can use sapply() to apply this transformation to a set of values</p>
<p>Create a simple function fillPO4:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>fillPO4 <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">if_else</span>(<span class="fu">is.na</span>(x), <span class="fl">42.897</span> <span class="sc">+</span> <span class="fl">1.293</span> <span class="sc">*</span> x, x)</span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a><span class="co"># If a value in x is missing (NA), it is replaced with a calculated value using the formula 42.897 + 1.293 * x.</span></span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a><span class="co"># If a value in x is not missing, it remains unchanged.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>algae[<span class="fu">is.na</span>(algae<span class="sc">$</span>PO4), <span class="st">"PO4"</span>] <span class="ot">&lt;-</span> <span class="fu">sapply</span>(algae[<span class="fu">is.na</span>(algae<span class="sc">$</span>PO4), <span class="st">"oPO4"</span>], fillPO4)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Apply calls fillPO4 function repeatedly, each time using one value in algae[is.na(algae$PO4), “oPO4”] as an argument.</p>
<p>You can perform a similar operation on subsets of observations. For example, if PO4 is missing for data collected in summer and season affects PO4 values, you may consider to use a linear model constructed with summer data only to obtain a more accurate prediction of PO4 from oPO4.</p>
</section>
<section id="filling-unknowns-by-exploring-similarities-among-cases" class="level3">
<h3 class="anchored" data-anchor-id="filling-unknowns-by-exploring-similarities-among-cases">Filling unknowns by exploring similarities among cases</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(algae, <span class="at">package=</span><span class="st">"DMwR2"</span>)</span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>algae <span class="ot">&lt;-</span> algae[<span class="sc">-</span><span class="fu">manyNAs</span>(algae), ] </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>DM2R2 provides a method call knnImputation(). This method use the Euclidean distance to find the ten most similar cases of any water sample with some unknown value in a variable, and then use their values to fill in the unknown.</p>
<p>We can simply calculate the median of the values of the ten nearest neighbors to fill in the gaps. In case of unknown nominal variables (which do not occur in our algae data set), we would use the most frequent value (the mode) among the neighbors. The second method uses a weighted average of the values of the neighbors.</p>
<p>The weights decrease as the distance to the case of the neighbors increases.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>algae <span class="ot">&lt;-</span> <span class="fu">knnImputation</span>(algae, <span class="at">k =</span> <span class="dv">10</span>) <span class="co">#use the weighted average of k most similar samples</span></span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(algae, <span class="at">package=</span><span class="st">"DMwR2"</span>) <span class="co">#reloading data</span></span>
<span id="cb104-5"><a href="#cb104-5" aria-hidden="true" tabindex="-1"></a>algae <span class="ot">&lt;-</span> algae[<span class="sc">-</span><span class="fu">manyNAs</span>(algae), ] </span>
<span id="cb104-6"><a href="#cb104-6" aria-hidden="true" tabindex="-1"></a>algae <span class="ot">&lt;-</span> <span class="fu">knnImputation</span>(algae, <span class="at">k =</span> <span class="dv">10</span>, <span class="at">meth=</span><span class="st">"median"</span>) <span class="co">#use the median of k most similar samples</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To see what is in knnImputation() (You are not required to read and understand the code):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="fu">getAnywhere</span>(<span class="fu">knnImputation</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>A single object matching 'knnImputation' was found
It was found in the following places
  package:DMwR2
  namespace:DMwR2
with value

function (data, k = 10, scale = TRUE, meth = "weighAvg", distData = NULL) 
{
    n &lt;- nrow(data)
    if (!is.null(distData)) {
        distInit &lt;- n + 1
        data &lt;- rbind(data, distData)
    }
    else distInit &lt;- 1
    N &lt;- nrow(data)
    ncol &lt;- ncol(data)
    contAttrs &lt;- which(vapply(data, dplyr::type_sum, character(1)) %in% 
        c("dbl", "int"))
    nomAttrs &lt;- setdiff(seq.int(ncol), contAttrs)
    hasNom &lt;- length(nomAttrs)
    dm &lt;- data
    if (scale) 
        dm[, contAttrs] &lt;- scale(dm[, contAttrs])
    if (hasNom) 
        for (i in nomAttrs) dm[[i]] &lt;- as.integer(dm[[i]])
    dm &lt;- as.matrix(dm)
    nas &lt;- which(!complete.cases(dm))
    if (!is.null(distData)) 
        tgt.nas &lt;- nas[nas &lt;= n]
    else tgt.nas &lt;- nas
    if (length(tgt.nas) == 0) 
        warning("No case has missing values. Stopping as there is nothing to do.")
    xcomplete &lt;- dm[setdiff(distInit:N, nas), ]
    if (nrow(xcomplete) &lt; k) 
        stop("Not sufficient complete cases for computing neighbors.")
    for (i in tgt.nas) {
        tgtAs &lt;- which(is.na(dm[i, ]))
        dist &lt;- scale(xcomplete, dm[i, ], FALSE)
        xnom &lt;- setdiff(nomAttrs, tgtAs)
        if (length(xnom)) 
            dist[, xnom] &lt;- ifelse(dist[, xnom] &gt; 0, 1, dist[, 
                xnom])
        dist &lt;- dist[, -tgtAs]
        dist &lt;- sqrt(drop(dist^2 %*% rep(1, ncol(dist))))
        ks &lt;- order(dist)[seq(k)]
        for (j in tgtAs) if (meth == "median") 
            data[i, j] &lt;- centralValue(data[setdiff(distInit:N, 
                nas)[ks], j])
        else data[i, j] &lt;- centralValue(data[setdiff(distInit:N, 
            nas)[ks], j], exp(-dist[ks]))
    }
    data[1:n, ]
}
&lt;bytecode: 0x12382da88&gt;
&lt;environment: namespace:DMwR2&gt;</code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="scaling-and-normalization" class="level1">
<h1>Scaling and normalization</h1>
<p>Normalize value <code>x</code>: y = ( 𝑥- mean) / standard_deviation(x) using scale()</p>
<p>Normalize values in penguins dataset:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(palmerpenguins)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'palmerpenguins'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:modeldata':

    penguins</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(penguins)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="co"># select only numeric columns</span></span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a>penguins_numeric <span class="ot">&lt;-</span> <span class="fu">select</span>(penguins, bill_length_mm, bill_depth_mm, flipper_length_mm, body_mass_g)</span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a><span class="co"># normalize numeric columns</span></span>
<span id="cb111-5"><a href="#cb111-5" aria-hidden="true" tabindex="-1"></a>penguins_norm <span class="ot">&lt;-</span> <span class="fu">scale</span>(penguins_numeric)</span>
<span id="cb111-6"><a href="#cb111-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-7"><a href="#cb111-7" aria-hidden="true" tabindex="-1"></a><span class="co"># convert back to data frame and add species column</span></span>
<span id="cb111-8"><a href="#cb111-8" aria-hidden="true" tabindex="-1"></a>peng.norm <span class="ot">&lt;-</span> <span class="fu">cbind</span>(<span class="fu">as.data.frame</span>(penguins_norm), <span class="at">species =</span> penguins<span class="sc">$</span>species)</span>
<span id="cb111-9"><a href="#cb111-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-10"><a href="#cb111-10" aria-hidden="true" tabindex="-1"></a><span class="co"># because scale() takes numeric matrix as input, we first remove Species column, then use cbind() to add the column back after normalization.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(penguins)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      species          island    bill_length_mm  bill_depth_mm  
 Adelie   :152   Biscoe   :168   Min.   :32.10   Min.   :13.10  
 Chinstrap: 68   Dream    :124   1st Qu.:39.23   1st Qu.:15.60  
 Gentoo   :124   Torgersen: 52   Median :44.45   Median :17.30  
                                 Mean   :43.92   Mean   :17.15  
                                 3rd Qu.:48.50   3rd Qu.:18.70  
                                 Max.   :59.60   Max.   :21.50  
                                 NA's   :2       NA's   :2      
 flipper_length_mm  body_mass_g       sex           year     
 Min.   :172.0     Min.   :2700   female:165   Min.   :2007  
 1st Qu.:190.0     1st Qu.:3550   male  :168   1st Qu.:2007  
 Median :197.0     Median :4050   NA's  : 11   Median :2008  
 Mean   :200.9     Mean   :4202                Mean   :2008  
 3rd Qu.:213.0     3rd Qu.:4750                3rd Qu.:2009  
 Max.   :231.0     Max.   :6300                Max.   :2009  
 NA's   :2         NA's   :2                                 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(peng.norm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> bill_length_mm     bill_depth_mm      flipper_length_mm  body_mass_g     
 Min.   :-2.16535   Min.   :-2.05144   Min.   :-2.0563   Min.   :-1.8726  
 1st Qu.:-0.86031   1st Qu.:-0.78548   1st Qu.:-0.7762   1st Qu.:-0.8127  
 Median : 0.09672   Median : 0.07537   Median :-0.2784   Median :-0.1892  
 Mean   : 0.00000   Mean   : 0.00000   Mean   : 0.0000   Mean   : 0.0000  
 3rd Qu.: 0.83854   3rd Qu.: 0.78430   3rd Qu.: 0.8594   3rd Qu.: 0.6836  
 Max.   : 2.87166   Max.   : 2.20217   Max.   : 2.1395   Max.   : 2.6164  
 NA's   :2          NA's   :2          NA's   :2         NA's   :2        
      species   
 Adelie   :152  
 Chinstrap: 68  
 Gentoo   :124  
                
                
                
                </code></pre>
</div>
</div>
<p>scale() can also take an argument for center and an argument of scale to normalize data in some other ways. For example, 𝑦= (𝑥-min) / (max-min)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a>max <span class="ot">&lt;-</span> <span class="fu">apply</span>(<span class="fu">select</span>(penguins, <span class="sc">-</span>species), <span class="dv">2</span>, max, <span class="at">na.rm=</span><span class="cn">TRUE</span>)</span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a>min <span class="ot">&lt;-</span> <span class="fu">apply</span>(<span class="fu">select</span>(penguins, <span class="sc">-</span>species), <span class="dv">2</span>, min, <span class="at">na.rm=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a>max</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           island    bill_length_mm     bill_depth_mm flipper_length_mm 
      "Torgersen"            "59.6"            "21.5"             "231" 
      body_mass_g               sex              year 
           "6300"            "male"            "2009" </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a>min</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           island    bill_length_mm     bill_depth_mm flipper_length_mm 
         "Biscoe"            "32.1"            "13.1"             "172" 
      body_mass_g               sex              year 
           "2700"          "female"            "2007" </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="co"># min-max normalization</span></span>
<span id="cb121-2"><a href="#cb121-2" aria-hidden="true" tabindex="-1"></a>penguin_scaled <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">lapply</span>(penguins_numeric, <span class="cf">function</span>(x) (x <span class="sc">-</span> <span class="fu">min</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">/</span> (<span class="fu">max</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">-</span> <span class="fu">min</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))))</span>
<span id="cb121-3"><a href="#cb121-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-4"><a href="#cb121-4" aria-hidden="true" tabindex="-1"></a>penguin_scaled <span class="ot">&lt;-</span> <span class="fu">cbind</span>(penguins_norm, <span class="at">species =</span> penguins<span class="sc">$</span>species)</span>
<span id="cb121-5"><a href="#cb121-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb121-6"><a href="#cb121-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(penguin_scaled)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> bill_length_mm     bill_depth_mm      flipper_length_mm  body_mass_g     
 Min.   :-2.16535   Min.   :-2.05144   Min.   :-2.0563   Min.   :-1.8726  
 1st Qu.:-0.86031   1st Qu.:-0.78548   1st Qu.:-0.7762   1st Qu.:-0.8127  
 Median : 0.09672   Median : 0.07537   Median :-0.2784   Median :-0.1892  
 Mean   : 0.00000   Mean   : 0.00000   Mean   : 0.0000   Mean   : 0.0000  
 3rd Qu.: 0.83854   3rd Qu.: 0.78430   3rd Qu.: 0.8594   3rd Qu.: 0.6836  
 Max.   : 2.87166   Max.   : 2.20217   Max.   : 2.1395   Max.   : 2.6164  
 NA's   :2          NA's   :2          NA's   :2         NA's   :2        
    species     
 Min.   :1.000  
 1st Qu.:1.000  
 Median :2.000  
 Mean   :1.919  
 3rd Qu.:3.000  
 Max.   :3.000  
                </code></pre>
</div>
</div>
<section id="discretizing-variables-binning" class="level2">
<h2 class="anchored" data-anchor-id="discretizing-variables-binning">Discretizing variables (binning)</h2>
<p>The process of transferring continuous functions, models, variables, and equations into discrete counterparts</p>
<p>Use dlookr’s binning(type = “equal”) for equal-length cuts (bins)</p>
<p>Use Hmisc’s cut2() for equal-depth cuts</p>
<p>Boston Housing data as an example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(Boston, <span class="at">package=</span><span class="st">"MASS"</span>)</span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(Boston<span class="sc">$</span>age)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
   2.90   45.02   77.50   68.57   94.08  100.00 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a>Boston<span class="sc">$</span>newAge <span class="ot">&lt;-</span> dlookr<span class="sc">::</span><span class="fu">binning</span>(Boston<span class="sc">$</span>age, <span class="dv">5</span>, <span class="at">type =</span> <span class="st">"equal"</span>) <span class="co">#create 5 bins and add new column newAge to Boston</span></span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(Boston<span class="sc">$</span>newAge)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         levels freq       rate
1   [2.9,22.32]   45 0.08893281
2 (22.32,41.74]   71 0.14031621
3 (41.74,61.16]   70 0.13833992
4 (61.16,80.58]   81 0.16007905
5   (80.58,100]  239 0.47233202</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a>Boston<span class="sc">$</span>newAge <span class="ot">&lt;-</span> dlookr<span class="sc">::</span><span class="fu">binning</span>(Boston<span class="sc">$</span>age, <span class="at">nbins =</span> <span class="dv">5</span>, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"very-young"</span>, <span class="st">"young"</span>, <span class="st">"mid"</span>, <span class="st">"older"</span>, <span class="st">"very-old"</span>), <span class="at">type =</span> <span class="st">"equal"</span>) <span class="co">#add labels</span></span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb127-3"><a href="#cb127-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(Boston<span class="sc">$</span>newAge)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      levels freq       rate
1 very-young   45 0.08893281
2      young   71 0.14031621
3        mid   70 0.13833992
4      older   81 0.16007905
5   very-old  239 0.47233202</code></pre>
</div>
</div>
<section id="equal-depth" class="level3">
<h3 class="anchored" data-anchor-id="equal-depth">Equal Depth</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(<span class="st">"Hmisc"</span>))</span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">install.packages</span>(<span class="st">"Hmisc"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: Hmisc</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'Hmisc'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:parsnip':

    translate</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:dplyr':

    src, summarize</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:dlookr':

    describe</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    format.pval, units</code></pre>
</div>
<div class="sourceCode cell-code" id="cb136"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb136-1"><a href="#cb136-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Hmisc)</span>
<span id="cb136-2"><a href="#cb136-2" aria-hidden="true" tabindex="-1"></a>Boston<span class="sc">$</span>newAge <span class="ot">&lt;-</span> <span class="fu">cut2</span>(Boston<span class="sc">$</span>age, <span class="at">g =</span> <span class="dv">5</span>) <span class="co">#create 5 equal-depth bins and add new column newAge to Boston</span></span>
<span id="cb136-3"><a href="#cb136-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-4"><a href="#cb136-4" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(Boston<span class="sc">$</span>newAge)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
[ 2.9, 38.1) [38.1, 66.1) [66.1, 86.1) [86.1, 95.7) [95.7,100.0] 
         102          101          101          101          101 </code></pre>
</div>
</div>
</section>
<section id="assign-labels" class="level3">
<h3 class="anchored" data-anchor-id="assign-labels">Assign Labels</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb138"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a>Boston<span class="sc">$</span>newAge <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">cut2</span>(Boston<span class="sc">$</span>age, <span class="at">g =</span> <span class="dv">5</span>), <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"very-young"</span>, <span class="st">"young"</span>, <span class="st">"mid"</span>, <span class="st">"older"</span>, <span class="st">"very-old"</span>))</span>
<span id="cb138-2"><a href="#cb138-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-3"><a href="#cb138-3" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(Boston<span class="sc">$</span>newAge)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
very-young      young        mid      older   very-old 
       102        101        101        101        101 </code></pre>
</div>
</div>
<p>Plot an equal-width histogram of width 10:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(Boston<span class="sc">$</span>age, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">101</span>,<span class="at">by =</span> <span class="dv">10</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="r-python-exercise2_files/figure-html/unnamed-chunk-71-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Using ggplot</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb141"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb141-2"><a href="#cb141-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-3"><a href="#cb141-3" aria-hidden="true" tabindex="-1"></a>Boston <span class="sc">|&gt;</span></span>
<span id="cb141-4"><a href="#cb141-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> age)) <span class="sc">+</span></span>
<span id="cb141-5"><a href="#cb141-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="r-python-exercise2_files/figure-html/unnamed-chunk-72-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="decimal-scaling" class="level2">
<h2 class="anchored" data-anchor-id="decimal-scaling">Decimal Scaling</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb142"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">20</span>, <span class="dv">30</span>, <span class="dv">50</span>, <span class="dv">100</span>)</span>
<span id="cb142-2"><a href="#cb142-2" aria-hidden="true" tabindex="-1"></a>(<span class="at">nDigits =</span> <span class="fu">nchar</span>(<span class="fu">max</span>(<span class="fu">abs</span>(data)))) <span class="co">#nchar counts the number of characters</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb144"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a>(<span class="at">decimalScale =</span> data <span class="sc">/</span> (<span class="dv">10</span><span class="sc">^</span>nDigits))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.01 0.02 0.03 0.05 0.10</code></pre>
</div>
</div>
<section id="smoothing-by-bin-mean" class="level3">
<h3 class="anchored" data-anchor-id="smoothing-by-bin-mean">Smoothing by bin mean</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb146"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a>age <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">13</span>, <span class="dv">15</span>, <span class="dv">16</span>, <span class="dv">16</span>, <span class="dv">19</span>, <span class="dv">20</span>, <span class="dv">20</span>, <span class="dv">21</span>, <span class="dv">22</span>, <span class="dv">22</span>, <span class="dv">25</span>, <span class="dv">25</span>, <span class="dv">25</span>, <span class="dv">25</span>, <span class="dv">30</span>)</span>
<span id="cb146-2"><a href="#cb146-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-3"><a href="#cb146-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Separate data into bins of depth 3</span></span>
<span id="cb146-4"><a href="#cb146-4" aria-hidden="true" tabindex="-1"></a>(<span class="at">bins =</span> <span class="fu">matrix</span>(age, <span class="at">nrow =</span> <span class="fu">length</span>(age) <span class="sc">/</span> <span class="dv">5</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2] [,3] [,4] [,5]
[1,]   13   15   16   16   19
[2,]   20   20   21   22   22
[3,]   25   25   25   25   30</code></pre>
</div>
</div>
<p>Find the average of each bin:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb148"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a>(<span class="at">bin_means =</span> <span class="fu">apply</span>(bins, <span class="dv">1</span>, <span class="at">FUN =</span> mean))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 15.8 21.0 26.0</code></pre>
</div>
</div>
<p>Replace values with their bin mean:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb150"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(bins)) {</span>
<span id="cb150-2"><a href="#cb150-2" aria-hidden="true" tabindex="-1"></a>   bins[i,] <span class="ot">=</span> bin_means[i]</span>
<span id="cb150-3"><a href="#cb150-3" aria-hidden="true" tabindex="-1"></a> }</span>
<span id="cb150-4"><a href="#cb150-4" aria-hidden="true" tabindex="-1"></a>bins</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2] [,3] [,4] [,5]
[1,] 15.8 15.8 15.8 15.8 15.8
[2,] 21.0 21.0 21.0 21.0 21.0
[3,] 26.0 26.0 26.0 26.0 26.0</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb152"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a>(<span class="at">age_bin_mean_smoothed =</span> <span class="fu">round</span>(<span class="fu">as.vector</span>(<span class="fu">t</span>(bins)), <span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 15.8 15.8 15.8 15.8 15.8 21.0 21.0 21.0 21.0 21.0 26.0 26.0 26.0 26.0 26.0</code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="variable-correlations-and-dimensionality-reduction" class="level1">
<h1>Variable correlations and dimensionality reduction</h1>
<section id="chi-squared-test" class="level2">
<h2 class="anchored" data-anchor-id="chi-squared-test">Chi-squared test</h2>
<p>H0: (Prisoner’s race)(Victim’s race) are independent.</p>
<p>data (contingency table):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb154"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a>racetable <span class="ot">=</span> <span class="fu">rbind</span>(<span class="fu">c</span>(<span class="dv">151</span>,<span class="dv">9</span>), <span class="fu">c</span>(<span class="dv">63</span>,<span class="dv">103</span>))</span>
<span id="cb154-2"><a href="#cb154-2" aria-hidden="true" tabindex="-1"></a>test1 <span class="ot">=</span> <span class="fu">chisq.test</span>(racetable, <span class="at">correct=</span>F)</span>
<span id="cb154-3"><a href="#cb154-3" aria-hidden="true" tabindex="-1"></a>test1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Pearson's Chi-squared test

data:  racetable
X-squared = 115.01, df = 1, p-value &lt; 2.2e-16</code></pre>
</div>
</div>
<p>p-value is less than 0.05: chance to get X-squared value of 115.01 assuming H0 is true is very slim (close to 0), so reject H0.</p>
</section>
<section id="loglinear-model" class="level2">
<h2 class="anchored" data-anchor-id="loglinear-model">Loglinear model</h2>
<p>Extending chi-squared to more than 2 categorical variables.</p>
<p>Loglinear models model cell counts in contingency tables.</p>
<p>Adapted from https://data.library.virginia.edu/an-introduction-to-loglinear-models/:</p>
<p>Data from Agresti (1996, Table 6.3) modified. It summarizes responses from a survey that asked high school seniors in a particular city whether they had ever used alcohol, cigarettes, or marijuana. A categorical variable age is added.</p>
<p>We’re interested in how the cell counts in the contingency table depend on the levels of the categorical variables.</p>
<p>Get the data in. We will be analyzing cells in contingency tables, so use a multi-dimensional array to hold the data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb156"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a>seniors <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="at">data =</span> <span class="fu">c</span>(<span class="dv">911</span>, <span class="dv">44</span>, <span class="dv">538</span>, <span class="dv">456</span>, <span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">43</span>, <span class="dv">279</span>, <span class="dv">911</span>, <span class="dv">44</span>, <span class="dv">538</span>, <span class="dv">456</span>, <span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">43</span>, <span class="dv">279</span>), </span>
<span id="cb156-2"><a href="#cb156-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">dim =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>),</span>
<span id="cb156-3"><a href="#cb156-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">dimnames =</span> <span class="fu">list</span>(<span class="st">"cigarette"</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"yes"</span>, <span class="st">"no"</span>),</span>
<span id="cb156-4"><a href="#cb156-4" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">"marijuana"</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"yes"</span>, <span class="st">"no"</span>),</span>
<span id="cb156-5"><a href="#cb156-5" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">"alcohol"</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="st">"yes"</span>, <span class="st">"no"</span>), </span>
<span id="cb156-6"><a href="#cb156-6" aria-hidden="true" tabindex="-1"></a>                                  <span class="st">"age"</span> <span class="ot">=</span><span class="fu">c</span>(<span class="st">"younger"</span>, <span class="st">"older"</span>)))</span>
<span id="cb156-7"><a href="#cb156-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb156-8"><a href="#cb156-8" aria-hidden="true" tabindex="-1"></a>seniors</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>, , alcohol = yes, age = younger

         marijuana
cigarette yes  no
      yes 911 538
      no   44 456

, , alcohol = no, age = younger

         marijuana
cigarette yes  no
      yes   3  43
      no    2 279

, , alcohol = yes, age = older

         marijuana
cigarette yes  no
      yes 911 538
      no   44 456

, , alcohol = no, age = older

         marijuana
cigarette yes  no
      yes   3  43
      no    2 279</code></pre>
</div>
</div>
<p>Next, do loglinear modeling using the glm function (generalized linear models).</p>
<p>We need to convert the array to a table then to a data frame.</p>
<p>Calling as.data.frame on a table object in R returns a data frame with a column for cell frequencies where each row represents a unique combination of variables.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb158"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a>seniors.tb <span class="ot">&lt;-</span> <span class="fu">as.table</span>(seniors)</span>
<span id="cb158-2"><a href="#cb158-2" aria-hidden="true" tabindex="-1"></a>seniors.tb</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>, , alcohol = yes, age = younger

         marijuana
cigarette yes  no
      yes 911 538
      no   44 456

, , alcohol = no, age = younger

         marijuana
cigarette yes  no
      yes   3  43
      no    2 279

, , alcohol = yes, age = older

         marijuana
cigarette yes  no
      yes 911 538
      no   44 456

, , alcohol = no, age = older

         marijuana
cigarette yes  no
      yes   3  43
      no    2 279</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb160"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true" tabindex="-1"></a>seniors.df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(seniors.tb)</span>
<span id="cb160-2"><a href="#cb160-2" aria-hidden="true" tabindex="-1"></a>seniors.df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   cigarette marijuana alcohol     age Freq
1        yes       yes     yes younger  911
2         no       yes     yes younger   44
3        yes        no     yes younger  538
4         no        no     yes younger  456
5        yes       yes      no younger    3
6         no       yes      no younger    2
7        yes        no      no younger   43
8         no        no      no younger  279
9        yes       yes     yes   older  911
10        no       yes     yes   older   44
11       yes        no     yes   older  538
12        no        no     yes   older  456
13       yes       yes      no   older    3
14        no       yes      no   older    2
15       yes        no      no   older   43
16        no        no      no   older  279</code></pre>
</div>
</div>
<p>Next, we model Freq (this is the count in the contingency table) as a function of the three variables using the glm function. Set family = poisson because we are assuming independent counts.</p>
<p>Poisson distribution: discrete probability distribution that expresses the probability of a given number of events occurring in a fixed interval of time or space if these events occur with a known constant rate and independently of the time since the last event.</p>
<p>Our H0 is the four variables are independent of one another.</p>
<p>We will test the saturated model first (including all variables and all two-way and three-way interactions), because it will show the significance for all variables and their interactions</p>
<p>Use * to connect all variables to get a saturated model, which will fit the data perfectly. Then we will remove effects that are not significant.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb162"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb162-1"><a href="#cb162-1" aria-hidden="true" tabindex="-1"></a>mod.S4 <span class="ot">&lt;-</span> <span class="fu">glm</span>(Freq <span class="sc">~</span> (cigarette <span class="sc">*</span> marijuana <span class="sc">*</span> alcohol <span class="sc">*</span> age), <span class="at">data =</span> seniors.df, <span class="at">family=</span>poisson)</span>
<span id="cb162-2"><a href="#cb162-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod.S4)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = Freq ~ (cigarette * marijuana * alcohol * age), 
    family = poisson, data = seniors.df)

Coefficients:
                                             Estimate Std. Error z value
(Intercept)                                 6.815e+00  3.313e-02 205.682
cigaretteno                                -3.030e+00  1.544e-01 -19.633
marijuanano                                -5.267e-01  5.437e-02  -9.686
alcoholno                                  -5.716e+00  5.783e-01  -9.884
ageolder                                   -1.946e-15  4.685e-02   0.000
cigaretteno:marijuanano                     2.865e+00  1.670e-01  17.159
cigaretteno:alcoholno                       2.625e+00  9.258e-01   2.835
marijuanano:alcoholno                       3.189e+00  5.996e-01   5.319
cigaretteno:ageolder                        7.281e-15  2.183e-01   0.000
marijuanano:ageolder                        1.351e-15  7.690e-02   0.000
alcoholno:ageolder                          2.098e-15  8.178e-01   0.000
cigaretteno:marijuanano:alcoholno          -5.895e-01  9.424e-01  -0.626
cigaretteno:marijuanano:ageolder           -6.706e-15  2.361e-01   0.000
cigaretteno:alcoholno:ageolder             -3.770e-15  1.309e+00   0.000
marijuanano:alcoholno:ageolder             -1.143e-15  8.480e-01   0.000
cigaretteno:marijuanano:alcoholno:ageolder  3.239e-15  1.333e+00   0.000
                                           Pr(&gt;|z|)    
(Intercept)                                 &lt; 2e-16 ***
cigaretteno                                 &lt; 2e-16 ***
marijuanano                                 &lt; 2e-16 ***
alcoholno                                   &lt; 2e-16 ***
ageolder                                    1.00000    
cigaretteno:marijuanano                     &lt; 2e-16 ***
cigaretteno:alcoholno                       0.00458 ** 
marijuanano:alcoholno                      1.04e-07 ***
cigaretteno:ageolder                        1.00000    
marijuanano:ageolder                        1.00000    
alcoholno:ageolder                          1.00000    
cigaretteno:marijuanano:alcoholno           0.53160    
cigaretteno:marijuanano:ageolder            1.00000    
cigaretteno:alcoholno:ageolder              1.00000    
marijuanano:alcoholno:ageolder              1.00000    
cigaretteno:marijuanano:alcoholno:ageolder  1.00000    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance: 5.7029e+03  on 15  degrees of freedom
Residual deviance: 8.7041e-14  on  0  degrees of freedom
AIC: 130.09

Number of Fisher Scoring iterations: 3</code></pre>
</div>
</div>
<p>Note: “Residual deviance” indicates the fitness of the model to the data. A good fit would have residual deviance less than or close to its degree of freedom. That is the case for the saturated model, which is expected.</p>
<p>Then look at “Coefficients” (these are the lamdas). Many of them are not significant (<em>, <strong>,</strong></em> indicates significant lamdas)</p>
<p>By examining those insignificant effects, we see they all involve age.</p>
<p>Now lets’ remove age and re-generate a model with the remaining three variables.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb164"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb164-1"><a href="#cb164-1" aria-hidden="true" tabindex="-1"></a>mod.S3 <span class="ot">&lt;-</span> <span class="fu">glm</span>(Freq <span class="sc">~</span> (cigarette <span class="sc">*</span> marijuana <span class="sc">*</span> alcohol), <span class="at">data =</span> seniors.df, <span class="at">family =</span> poisson)</span>
<span id="cb164-2"><a href="#cb164-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod.S3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = Freq ~ (cigarette * marijuana * alcohol), family = poisson, 
    data = seniors.df)

Coefficients:
                                  Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)                        6.81454    0.02343 290.878  &lt; 2e-16 ***
cigaretteno                       -3.03035    0.10914 -27.765  &lt; 2e-16 ***
marijuanano                       -0.52668    0.03845 -13.699  &lt; 2e-16 ***
alcoholno                         -5.71593    0.40892 -13.978  &lt; 2e-16 ***
cigaretteno:marijuanano            2.86499    0.11806  24.267  &lt; 2e-16 ***
cigaretteno:alcoholno              2.62489    0.65466   4.010 6.08e-05 ***
marijuanano:alcoholno              3.18927    0.42400   7.522 5.40e-14 ***
cigaretteno:marijuanano:alcoholno -0.58951    0.66635  -0.885    0.376    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance:  5.7029e+03  on 15  degrees of freedom
Residual deviance: -1.7897e-13  on  8  degrees of freedom
AIC: 114.09

Number of Fisher Scoring iterations: 3</code></pre>
</div>
</div>
<p>We see the model fits well, and most effects are significant now.</p>
<p>The insignificant one is the 3-way interaction among the three factors</p>
<p>For data reduction, we are done – we removed age variable. Because all cigarette, marijuana, and alcohol effects are significant, we can’t remove any of these from the data set, even though the 3-way interaction is not significant.</p>
<p>For data modeling, we can remove the 3-way interaction by testing “Freq ~ (cigarette + marijuana + alcohol)^2” (^2 tells glm to check only two way interactions).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb166"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb166-1"><a href="#cb166-1" aria-hidden="true" tabindex="-1"></a>mod<span class="fl">.3</span> <span class="ot">&lt;-</span> <span class="fu">glm</span>(Freq <span class="sc">~</span> (cigarette <span class="sc">+</span> marijuana <span class="sc">+</span> alcohol)<span class="sc">^</span><span class="dv">2</span>, <span class="at">data =</span> seniors.df, <span class="at">family =</span> poisson)</span>
<span id="cb166-2"><a href="#cb166-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod<span class="fl">.3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = Freq ~ (cigarette + marijuana + alcohol)^2, family = poisson, 
    data = seniors.df)

Coefficients:
                        Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)              6.81387    0.02342 290.902   &lt;2e-16 ***
cigaretteno             -3.01575    0.10721 -28.130   &lt;2e-16 ***
marijuanano             -0.52486    0.03838 -13.674   &lt;2e-16 ***
alcoholno               -5.52827    0.31976 -17.289   &lt;2e-16 ***
cigaretteno:marijuanano  2.84789    0.11585  24.582   &lt;2e-16 ***
cigaretteno:alcoholno    2.05453    0.12308  16.692   &lt;2e-16 ***
marijuanano:alcoholno    2.98601    0.32858   9.088   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance: 5702.92195  on 15  degrees of freedom
Residual deviance:    0.74797  on  9  degrees of freedom
AIC: 112.83

Number of Fisher Scoring iterations: 4</code></pre>
</div>
</div>
<p>Now compare the fitted and observed values and see how well they match up:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb168"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb168-1"><a href="#cb168-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cbind</span>(mod<span class="fl">.3</span><span class="sc">$</span>data, <span class="fu">fitted</span>(mod<span class="fl">.3</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   cigarette marijuana alcohol     age Freq fitted(mod.3)
1        yes       yes     yes younger  911     910.38317
2         no       yes     yes younger   44      44.61683
3        yes        no     yes younger  538     538.61683
4         no        no     yes younger  456     455.38317
5        yes       yes      no younger    3       3.61683
6         no       yes      no younger    2       1.38317
7        yes        no      no younger   43      42.38317
8         no        no      no younger  279     279.61683
9        yes       yes     yes   older  911     910.38317
10        no       yes     yes   older   44      44.61683
11       yes        no     yes   older  538     538.61683
12        no        no     yes   older  456     455.38317
13       yes       yes      no   older    3       3.61683
14        no       yes      no   older    2       1.38317
15       yes        no      no   older   43      42.38317
16        no        no      no   older  279     279.61683</code></pre>
</div>
</div>
<p>They fit well!</p>
</section>
<section id="correlations" class="level2">
<h2 class="anchored" data-anchor-id="correlations">Correlations</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb170"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb170-1"><a href="#cb170-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr) <span class="co"># data manipulation</span></span>
<span id="cb170-2"><a href="#cb170-2" aria-hidden="true" tabindex="-1"></a>penguins_numeric <span class="sc">|&gt;</span> </span>
<span id="cb170-3"><a href="#cb170-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>() <span class="sc">|&gt;</span></span>
<span id="cb170-4"><a href="#cb170-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">correlate</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 12 × 3
   var1              var2              coef_corr
   &lt;fct&gt;             &lt;fct&gt;                 &lt;dbl&gt;
 1 bill_depth_mm     bill_length_mm       -0.235
 2 flipper_length_mm bill_length_mm        0.656
 3 body_mass_g       bill_length_mm        0.595
 4 bill_length_mm    bill_depth_mm        -0.235
 5 flipper_length_mm bill_depth_mm        -0.584
 6 body_mass_g       bill_depth_mm        -0.472
 7 bill_length_mm    flipper_length_mm     0.656
 8 bill_depth_mm     flipper_length_mm    -0.584
 9 body_mass_g       flipper_length_mm     0.871
10 bill_length_mm    body_mass_g           0.595
11 bill_depth_mm     body_mass_g          -0.472
12 flipper_length_mm body_mass_g           0.871</code></pre>
</div>
</div>
<p>bill_length_mm and flipper_length_mm are highly negatively correlated, body_mass_g and flipper_length_mm are strongly positively correlated as well.</p>
</section>
<section id="principal-components-analysis-pca" class="level2">
<h2 class="anchored" data-anchor-id="principal-components-analysis-pca">Principal components analysis (PCA)</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb172"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb172-1"><a href="#cb172-1" aria-hidden="true" tabindex="-1"></a>pca.data <span class="ot">&lt;-</span> penguins <span class="sc">|&gt;</span></span>
<span id="cb172-2"><a href="#cb172-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>() <span class="sc">|&gt;</span></span>
<span id="cb172-3"><a href="#cb172-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>species, <span class="sc">-</span>island, <span class="sc">-</span>sex) </span>
<span id="cb172-4"><a href="#cb172-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb172-5"><a href="#cb172-5" aria-hidden="true" tabindex="-1"></a>pca <span class="ot">&lt;-</span> <span class="fu">princomp</span>(pca.data)</span>
<span id="cb172-6"><a href="#cb172-6" aria-hidden="true" tabindex="-1"></a><span class="fu">loadings</span>(pca)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Loadings:
                  Comp.1 Comp.2 Comp.3 Comp.4 Comp.5
bill_length_mm            0.319  0.941  0.108       
bill_depth_mm                    0.144 -0.984       
flipper_length_mm         0.943 -0.304 -0.125       
body_mass_g        1.000                            
year                                           0.997

               Comp.1 Comp.2 Comp.3 Comp.4 Comp.5
SS loadings       1.0    1.0    1.0    1.0    1.0
Proportion Var    0.2    0.2    0.2    0.2    0.2
Cumulative Var    0.2    0.4    0.6    0.8    1.0</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb174"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb174-1"><a href="#cb174-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(pca<span class="sc">$</span>scores) <span class="co"># pca result is a list, and the component scores are elements in the list</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        Comp.1     Comp.2      Comp.3     Comp.4     Comp.5
[1,] -457.3251 -13.376298  1.24790414  0.3764738 -0.5892777
[2,] -407.2522  -9.205245 -0.03266674  1.0902167 -0.6935631
[3,] -957.0447   8.128321 -2.49146655 -0.7208225 -1.3723988
[4,] -757.1158   1.838910 -4.88056871 -2.0736684 -1.3477178
[5,] -557.1773  -3.416994 -1.12926657 -2.6292970 -1.1451328
[6,] -582.3093 -11.398030  0.80239704  1.1987261 -0.5976776</code></pre>
</div>
</div>
<p>If we are happy with capturing 75% of the original variance of the cases, we can reduce the original data to the first three components.</p>
<p>Component scores are computed based on the loading, for example:</p>
<p><code>comp3 = 0.941*bill_length_mm + 0.144*``bill_depth_mm``- 0.309*flipper_length_mm</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb176"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb176-1"><a href="#cb176-1" aria-hidden="true" tabindex="-1"></a>penguins_na <span class="ot">&lt;-</span> penguins <span class="sc">|&gt;</span> </span>
<span id="cb176-2"><a href="#cb176-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>()</span>
<span id="cb176-3"><a href="#cb176-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-4"><a href="#cb176-4" aria-hidden="true" tabindex="-1"></a>peng.reduced <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(pca<span class="sc">$</span>scores[,<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>], <span class="at">Species =</span> penguins_na<span class="sc">$</span>species)</span>
<span id="cb176-5"><a href="#cb176-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-6"><a href="#cb176-6" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(peng.reduced)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Comp.1     Comp.2      Comp.3 Species
1 -457.3251 -13.376298  1.24790414  Adelie
2 -407.2522  -9.205245 -0.03266674  Adelie
3 -957.0447   8.128321 -2.49146655  Adelie
4 -757.1158   1.838910 -4.88056871  Adelie
5 -557.1773  -3.416994 -1.12926657  Adelie
6 -582.3093 -11.398030  0.80239704  Adelie</code></pre>
</div>
</div>
<p>Now we can use <code>peng.reduced</code> data frame for subsequent analyses:</p>
<p>Haar Discrete Wavelet Transform, using the example shown in class</p>
<p>Output:</p>
<table class="table">
<colgroup>
<col style="width: 26%">
<col style="width: 73%">
</colgroup>
<tbody>
<tr class="odd">
<td>W:</td>
<td>A list with element&nbsp;i&nbsp;comprised of a matrix containing the&nbsp;ith level wavelet coefficients (differences)</td>
</tr>
<tr class="even">
<td>V:&nbsp;</td>
<td>A list with element&nbsp;i&nbsp;comprised of a matrix containing the&nbsp;ith level scaling coefficients (averages).</td>
</tr>
</tbody>
</table>
<div class="cell">
<div class="sourceCode cell-code" id="cb178"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb178-1"><a href="#cb178-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(<span class="st">"wavelets"</span>))</span>
<span id="cb178-2"><a href="#cb178-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">install.packages</span>(<span class="st">"wavelets"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: wavelets</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'wavelets'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:car':

    dwt</code></pre>
</div>
<div class="sourceCode cell-code" id="cb182"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb182-1"><a href="#cb182-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(wavelets)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb183"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb183-1"><a href="#cb183-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">4</span>, <span class="dv">4</span>)</span>
<span id="cb183-2"><a href="#cb183-2" aria-hidden="true" tabindex="-1"></a>wt <span class="ot">&lt;-</span> <span class="fu">dwt</span>(x,<span class="at">filter=</span><span class="st">"haar"</span>, <span class="at">n.levels =</span> <span class="dv">3</span>) <span class="co">#with 8-element vector, 3 level is the max.</span></span>
<span id="cb183-3"><a href="#cb183-3" aria-hidden="true" tabindex="-1"></a>wt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>An object of class "dwt"
Slot "W":
$W1
         [,1]
[1,] 0.000000
[2,] 1.414214
[3,] 1.414214
[4,] 0.000000

$W2
     [,1]
[1,]   -1
[2,]    0

$W3
         [,1]
[1,] 3.535534


Slot "V":
$V1
         [,1]
[1,] 2.828427
[2,] 1.414214
[3,] 5.656854
[4,] 5.656854

$V2
     [,1]
[1,]    3
[2,]    8

$V3
         [,1]
[1,] 7.778175


Slot "filter":
Filter Class: Daubechies
Name: HAAR
Length: 2
Level: 1
Wavelet Coefficients: 7.0711e-01 -7.0711e-01
Scaling Coefficients: 7.0711e-01 7.0711e-01


Slot "level":
[1] 3

Slot "n.boundary":
[1] 0 0 0

Slot "boundary":
[1] "periodic"

Slot "series":
     [,1]
[1,]    2
[2,]    2
[3,]    0
[4,]    2
[5,]    3
[6,]    5
[7,]    4
[8,]    4

Slot "class.X":
[1] "numeric"

Slot "attr.X":
list()

Slot "aligned":
[1] FALSE

Slot "coe":
[1] FALSE</code></pre>
</div>
</div>
<p>Why aren’t the W and V vectors having the same values as shown in class?</p>
<p>Because in class, use simply taking the average and differences/2, in the default Haar, the default coefficients are sqrt(2)/2, see the section in bold above.</p>
<p>Reconstruct the original:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb185"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb185-1"><a href="#cb185-1" aria-hidden="true" tabindex="-1"></a><span class="fu">idwt</span>(wt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2 2 0 2 3 5 4 4</code></pre>
</div>
</div>
<p>Obtain transform results as shown in class, use a different filter:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb187"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb187-1"><a href="#cb187-1" aria-hidden="true" tabindex="-1"></a>xt <span class="ot">=</span> <span class="fu">dwt</span>(x, <span class="at">filter =</span> <span class="fu">wt.filter</span>(<span class="fu">c</span>(<span class="fl">0.5</span>, <span class="sc">-</span><span class="fl">0.5</span>)), <span class="at">n.levels =</span> <span class="dv">3</span>)</span>
<span id="cb187-2"><a href="#cb187-2" aria-hidden="true" tabindex="-1"></a>xt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>An object of class "dwt"
Slot "W":
$W1
     [,1]
[1,]    0
[2,]    1
[3,]    1
[4,]    0

$W2
     [,1]
[1,] -0.5
[2,]  0.0

$W3
     [,1]
[1,] 1.25


Slot "V":
$V1
     [,1]
[1,]    2
[2,]    1
[3,]    4
[4,]    4

$V2
     [,1]
[1,]  1.5
[2,]  4.0

$V3
     [,1]
[1,] 2.75


Slot "filter":
Filter Class: none
Name: NONE
Length: 2
Level: 1
Wavelet Coefficients: 5.0000e-01 -5.0000e-01
Scaling Coefficients: 5.0000e-01 5.0000e-01


Slot "level":
[1] 3

Slot "n.boundary":
[1] 0 0 0

Slot "boundary":
[1] "periodic"

Slot "series":
     [,1]
[1,]    2
[2,]    2
[3,]    0
[4,]    2
[5,]    3
[6,]    5
[7,]    4
[8,]    4

Slot "class.X":
[1] "numeric"

Slot "attr.X":
list()

Slot "aligned":
[1] FALSE

Slot "coe":
[1] FALSE</code></pre>
</div>
</div>
<p>Reconstruct the original:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb189"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb189-1"><a href="#cb189-1" aria-hidden="true" tabindex="-1"></a><span class="fu">idwt</span>(xt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  0.3125  0.3125 -0.4375  0.5625  0.0000  1.0000  0.5000  0.5000</code></pre>
</div>
</div>
</section>
</section>
<section id="sampling" class="level1">
<h1>Sampling</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb191"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb191-1"><a href="#cb191-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb191-2"><a href="#cb191-2" aria-hidden="true" tabindex="-1"></a>age <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">25</span>, <span class="dv">25</span>, <span class="dv">25</span>, <span class="dv">30</span>, <span class="dv">33</span>, <span class="dv">33</span>, <span class="dv">35</span>, <span class="dv">40</span>, <span class="dv">45</span>, <span class="dv">46</span>, <span class="dv">52</span>, <span class="dv">70</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="simple-random-sampling-without-replacement" class="level2">
<h2 class="anchored" data-anchor-id="simple-random-sampling-without-replacement">Simple random sampling, without replacement:</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb192"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb192-1"><a href="#cb192-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Take 5 random data points from the data frame age</span></span>
<span id="cb192-2"><a href="#cb192-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(age, <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 45 30 35 25 25</code></pre>
</div>
</div>
</section>
<section id="simple-random-sampling-with-replacement" class="level2">
<h2 class="anchored" data-anchor-id="simple-random-sampling-with-replacement">Simple random sampling, with replacement:</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb194"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb194-1"><a href="#cb194-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(age, <span class="dv">5</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 35 52 25 52 25</code></pre>
</div>
</div>
</section>
<section id="stratified-sampling" class="level2">
<h2 class="anchored" data-anchor-id="stratified-sampling">Stratified sampling</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb196"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb196-1"><a href="#cb196-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb196-2"><a href="#cb196-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>) <span class="co">#make results the same each run</span></span>
<span id="cb196-3"><a href="#cb196-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(algae)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    season       size       speed         mxPH            mnO2       
 autumn:40   large :44   high  :84   Min.   :5.600   Min.   : 1.500  
 spring:53   medium:84   low   :33   1st Qu.:7.705   1st Qu.: 7.825  
 summer:44   small :70   medium:81   Median :8.060   Median : 9.800  
 winter:61                           Mean   :8.019   Mean   : 9.135  
                                     3rd Qu.:8.400   3rd Qu.:10.800  
                                     Max.   :9.700   Max.   :13.400  
       Cl               NO3              NH4                oPO4       
 Min.   :  0.222   Min.   : 0.050   Min.   :    5.00   Min.   :  1.00  
 1st Qu.: 10.425   1st Qu.: 1.296   1st Qu.:   38.33   1st Qu.: 15.70  
 Median : 32.178   Median : 2.675   Median :  103.17   Median : 40.15  
 Mean   : 42.434   Mean   : 3.282   Mean   :  501.30   Mean   : 73.59  
 3rd Qu.: 57.492   3rd Qu.: 4.446   3rd Qu.:  226.95   3rd Qu.: 99.33  
 Max.   :391.500   Max.   :45.650   Max.   :24064.00   Max.   :564.60  
      PO4              Chla               a1               a2        
 Min.   :  1.00   Min.   :  0.200   Min.   : 0.000   Min.   : 0.000  
 1st Qu.: 41.38   1st Qu.:  2.000   1st Qu.: 1.525   1st Qu.: 0.000  
 Median :103.29   Median :  5.155   Median : 6.950   Median : 3.000  
 Mean   :137.88   Mean   : 13.355   Mean   :16.996   Mean   : 7.471  
 3rd Qu.:213.75   3rd Qu.: 17.200   3rd Qu.:24.800   3rd Qu.:11.275  
 Max.   :771.60   Max.   :110.456   Max.   :89.800   Max.   :72.600  
       a3               a4               a5               a6        
 Min.   : 0.000   Min.   : 0.000   Min.   : 0.000   Min.   : 0.000  
 1st Qu.: 0.000   1st Qu.: 0.000   1st Qu.: 0.000   1st Qu.: 0.000  
 Median : 1.550   Median : 0.000   Median : 2.000   Median : 0.000  
 Mean   : 4.334   Mean   : 1.997   Mean   : 5.116   Mean   : 6.005  
 3rd Qu.: 4.975   3rd Qu.: 2.400   3rd Qu.: 7.500   3rd Qu.: 6.975  
 Max.   :42.800   Max.   :44.600   Max.   :44.400   Max.   :77.600  
       a7        
 Min.   : 0.000  
 1st Qu.: 0.000  
 Median : 1.000  
 Mean   : 2.487  
 3rd Qu.: 2.400  
 Max.   :31.600  </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb198"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb198-1"><a href="#cb198-1" aria-hidden="true" tabindex="-1"></a>sample <span class="ot">&lt;-</span>algae <span class="sc">|&gt;</span> <span class="fu">group_by</span>(season) <span class="sc">|&gt;</span> <span class="fu">sample_frac</span>(<span class="fl">0.25</span>)</span>
<span id="cb198-2"><a href="#cb198-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(sample)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    season       size       speed         mxPH            mnO2       
 autumn:10   large :18   high  :16   Min.   :5.600   Min.   : 1.500  
 spring:13   medium:20   low   :13   1st Qu.:7.840   1st Qu.: 8.200  
 summer:11   small :11   medium:20   Median :8.100   Median : 9.700  
 winter:15                           Mean   :8.126   Mean   : 9.084  
                                     3rd Qu.:8.500   3rd Qu.:10.800  
                                     Max.   :9.700   Max.   :11.800  
       Cl               NO3             NH4               oPO4       
 Min.   :  0.222   Min.   :0.130   Min.   :   5.00   Min.   :  1.00  
 1st Qu.:  9.055   1st Qu.:0.921   1st Qu.:  43.75   1st Qu.: 21.08  
 Median : 28.333   Median :2.680   Median : 103.33   Median : 49.00  
 Mean   : 39.175   Mean   :2.794   Mean   : 213.60   Mean   : 78.49  
 3rd Qu.: 51.113   3rd Qu.:4.053   3rd Qu.: 225.00   3rd Qu.:125.67  
 Max.   :173.750   Max.   :6.640   Max.   :1495.00   Max.   :267.75  
      PO4              Chla               a1              a2       
 Min.   :  1.00   Min.   :  0.300   Min.   : 0.00   Min.   : 0.00  
 1st Qu.: 69.93   1st Qu.:  2.500   1st Qu.: 1.20   1st Qu.: 1.50  
 Median :125.80   Median :  6.209   Median : 5.70   Median : 5.60  
 Mean   :142.05   Mean   : 14.848   Mean   :17.94   Mean   :10.24  
 3rd Qu.:228.36   3rd Qu.: 20.829   3rd Qu.:18.10   3rd Qu.:14.50  
 Max.   :391.75   Max.   :110.456   Max.   :86.60   Max.   :72.60  
       a3               a4               a5               a6       
 Min.   : 0.000   Min.   : 0.000   Min.   : 0.000   Min.   : 0.00  
 1st Qu.: 0.000   1st Qu.: 0.000   1st Qu.: 0.000   1st Qu.: 0.00  
 Median : 1.400   Median : 0.000   Median : 1.200   Median : 0.00  
 Mean   : 3.498   Mean   : 1.349   Mean   : 4.678   Mean   : 6.12  
 3rd Qu.: 4.000   3rd Qu.: 1.800   3rd Qu.: 7.700   3rd Qu.: 5.10  
 Max.   :24.800   Max.   :13.400   Max.   :22.100   Max.   :52.50  
       a7        
 Min.   : 0.000  
 1st Qu.: 0.000  
 Median : 1.000  
 Mean   : 2.367  
 3rd Qu.: 2.200  
 Max.   :31.200  </code></pre>
</div>
</div>
</section>
<section id="cluster-sampling" class="level2">
<h2 class="anchored" data-anchor-id="cluster-sampling">Cluster sampling</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb200"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb200-1"><a href="#cb200-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(<span class="st">"sampling"</span>))</span>
<span id="cb200-2"><a href="#cb200-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">install.packages</span>(<span class="st">"sampling"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: sampling</code></pre>
</div>
<div class="sourceCode cell-code" id="cb202"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb202-1"><a href="#cb202-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sampling)</span>
<span id="cb202-2"><a href="#cb202-2" aria-hidden="true" tabindex="-1"></a>age <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">13</span>, <span class="dv">15</span>, <span class="dv">16</span>, <span class="dv">16</span>, <span class="dv">19</span>, <span class="dv">20</span>, <span class="dv">20</span>, <span class="dv">21</span>, <span class="dv">22</span>, <span class="dv">22</span>, <span class="dv">25</span>, <span class="dv">25</span>, <span class="dv">25</span>, <span class="dv">25</span>, <span class="dv">30</span>, <span class="dv">33</span>, <span class="dv">33</span>, <span class="dv">35</span>, <span class="dv">35</span>, <span class="dv">35</span>, <span class="dv">35</span>, <span class="dv">36</span>, <span class="dv">40</span>, <span class="dv">45</span>, <span class="dv">46</span>, <span class="dv">52</span>, <span class="dv">70</span>)</span>
<span id="cb202-3"><a href="#cb202-3" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> <span class="fu">kmeans</span>(age, <span class="dv">3</span>) <span class="co">#cluster on age to form 3 clusters</span></span>
<span id="cb202-4"><a href="#cb202-4" aria-hidden="true" tabindex="-1"></a>s<span class="sc">$</span>cluster</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 3 3 3 3 3 2 2 2 2 2 2 2 2 2 2 1 1 1 1 1 1 1 1 1 1 1 1</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb204"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb204-1"><a href="#cb204-1" aria-hidden="true" tabindex="-1"></a>ageframe <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(age)</span>
<span id="cb204-2"><a href="#cb204-2" aria-hidden="true" tabindex="-1"></a>ageframe<span class="sc">$</span>condition <span class="ot">&lt;-</span> s<span class="sc">$</span>cluster <span class="co"># add cluster label as condition</span></span>
<span id="cb204-3"><a href="#cb204-3" aria-hidden="true" tabindex="-1"></a><span class="fu">cluster</span>(ageframe, <span class="at">clustername =</span> <span class="st">"condition"</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="co"># select 2 clusters out of the three</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in cluster(ageframe, clustername = "condition", size = 2): the method
is not specified; by default, the method is srswor</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>   condition ID_unit      Prob
1          1      16 0.6666667
2          1      17 0.6666667
3          1      18 0.6666667
4          1      19 0.6666667
5          1      20 0.6666667
6          1      21 0.6666667
7          1      22 0.6666667
8          1      23 0.6666667
9          1      24 0.6666667
10         1      25 0.6666667
11         1      26 0.6666667
12         1      27 0.6666667
13         3       1 0.6666667
14         3       4 0.6666667
15         3       5 0.6666667
16         3       2 0.6666667
17         3       3 0.6666667</code></pre>
</div>
</div>
</section>
</section>
<section id="handling-text-datasets" class="level1">
<h1>Handling Text Datasets</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb207"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb207-1"><a href="#cb207-1" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(tm,</span>
<span id="cb207-2"><a href="#cb207-2" aria-hidden="true" tabindex="-1"></a>               SnowballC)<span class="co">#tm uses SnowballC for stemming</span></span>
<span id="cb207-3"><a href="#cb207-3" aria-hidden="true" tabindex="-1"></a><span class="co"># read corpus</span></span>
<span id="cb207-4"><a href="#cb207-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Emails.csv,  holding some of Hillary's emails</span></span>
<span id="cb207-5"><a href="#cb207-5" aria-hidden="true" tabindex="-1"></a><span class="co">#data &lt;- read.csv(here::here("data", "Emails.csv"), stringsAsFactors = FALSE)</span></span>
<span id="cb207-6"><a href="#cb207-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb207-7"><a href="#cb207-7" aria-hidden="true" tabindex="-1"></a>data<span class="ot">&lt;-</span><span class="fu">read.csv</span>(<span class="st">"/Users/shashwatsingh/Documents/GitHub/r-python-exercise2-shashwatsinghds/data/Emails.csv"</span>)</span>
<span id="cb207-8"><a href="#cb207-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb207-9"><a href="#cb207-9" aria-hidden="true" tabindex="-1"></a>docs <span class="ot">&lt;-</span> <span class="fu">Corpus</span>(<span class="fu">VectorSource</span>(data<span class="sc">$</span>RawText))</span>
<span id="cb207-10"><a href="#cb207-10" aria-hidden="true" tabindex="-1"></a><span class="fu">mode</span>(docs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "list"</code></pre>
</div>
</div>
<section id="inspect-a-doc" class="level2">
<h2 class="anchored" data-anchor-id="inspect-a-doc">Inspect a doc</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb209"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb209-1"><a href="#cb209-1" aria-hidden="true" tabindex="-1"></a>docs[[<span class="dv">20</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;&lt;PlainTextDocument&gt;&gt;
Metadata:  7
Content:  chars: 1150</code></pre>
</div>
</div>
</section>
<section id="preprocessing-text" class="level2">
<h2 class="anchored" data-anchor-id="preprocessing-text">Preprocessing text</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb211"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb211-1"><a href="#cb211-1" aria-hidden="true" tabindex="-1"></a>docs <span class="ot">&lt;-</span> docs <span class="sc">|&gt;</span></span>
<span id="cb211-2"><a href="#cb211-2" aria-hidden="true" tabindex="-1"></a>         <span class="fu">tm_map</span>(removePunctuation) <span class="sc">|&gt;</span></span>
<span id="cb211-3"><a href="#cb211-3" aria-hidden="true" tabindex="-1"></a>         <span class="fu">tm_map</span>(<span class="fu">content_transformer</span>(tolower)) <span class="sc">|&gt;</span> <span class="co">#to lower case</span></span>
<span id="cb211-4"><a href="#cb211-4" aria-hidden="true" tabindex="-1"></a>         <span class="fu">tm_map</span>(removeNumbers) <span class="sc">|&gt;</span></span>
<span id="cb211-5"><a href="#cb211-5" aria-hidden="true" tabindex="-1"></a>         <span class="fu">tm_map</span>(removeWords, <span class="fu">stopwords</span>(<span class="st">"en"</span>)) <span class="sc">|&gt;</span> <span class="co">#stopwords, such as a, an.</span></span>
<span id="cb211-6"><a href="#cb211-6" aria-hidden="true" tabindex="-1"></a>         <span class="fu">tm_map</span>(stripWhitespace) <span class="sc">|&gt;</span></span>
<span id="cb211-7"><a href="#cb211-7" aria-hidden="true" tabindex="-1"></a>         <span class="fu">tm_map</span>(stemDocument) <span class="co">#e.g. computer -&gt; comput</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in tm_map.SimpleCorpus(docs, removePunctuation): transformation drops
documents</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in tm_map.SimpleCorpus(tm_map(docs, removePunctuation),
content_transformer(tolower)): transformation drops documents</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in tm_map.SimpleCorpus(tm_map(tm_map(docs, removePunctuation),
content_transformer(tolower)), : transformation drops documents</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in tm_map.SimpleCorpus(tm_map(tm_map(tm_map(docs, removePunctuation), :
transformation drops documents</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in tm_map.SimpleCorpus(tm_map(tm_map(tm_map(tm_map(docs,
removePunctuation), : transformation drops documents</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in tm_map.SimpleCorpus(tm_map(tm_map(tm_map(tm_map(tm_map(docs, :
transformation drops documents</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb218"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb218-1"><a href="#cb218-1" aria-hidden="true" tabindex="-1"></a><span class="fu">content</span>(docs[[<span class="dv">20</span>]])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "unclassifi us depart state case f doc c date state dept produc hous select benghazi comm subject agreement sensit inform redact foia waiver releas full sent subject amaz sullivan jacob j sullivaniistategov wednesday septemb pm sherman wendi r h mill cheryl d nuland victoria j rein philipp re youth libya sherman wendi r sent wednesday septemb pm idrdintonemailcom hdrgclintonemailcom mill cheryl d sullivan jacob nuland victoria rein philipp subject fw youth libya hope see pictur kamala sent lakhdhir kamala sent wednesday septemb pm sherman wendi r cc escrogima ana grantham chris w subject youth libya libya hurra tv via facebook unclassifi us depart state case f doc c date state dept produc hous select benghazi comm subject agreement sensit inform redact foia waiver statescb"</code></pre>
</div>
</div>
<p>Convert text to a matrix using <code>TF*IDF scores</code> (see <code>TF*IDF</code> scores in Han’s text):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb220"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb220-1"><a href="#cb220-1" aria-hidden="true" tabindex="-1"></a>DTData <span class="ot">&lt;-</span> <span class="fu">DocumentTermMatrix</span>(docs, <span class="at">control =</span> <span class="fu">list</span>(<span class="at">weighting =</span> weightTfIdf))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in TermDocumentMatrix.SimpleCorpus(x, control): custom functions are
ignored</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in weighting(x): empty document(s): 1931</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb223"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb223-1"><a href="#cb223-1" aria-hidden="true" tabindex="-1"></a>DTData</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;&lt;DocumentTermMatrix (documents: 7945, terms: 42473)&gt;&gt;
Non-/sparse entries: 885247/336562738
Sparsity           : 100%
Maximal term length: 127
Weighting          : term frequency - inverse document frequency (normalized) (tf-idf)</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb225"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb225-1"><a href="#cb225-1" aria-hidden="true" tabindex="-1"></a><span class="fu">inspect</span>(DTData[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;&lt;DocumentTermMatrix (documents: 2, terms: 5)&gt;&gt;
Non-/sparse entries: 7/3
Sparsity           : 30%
Maximal term length: 9
Weighting          : term frequency - inverse document frequency (normalized) (tf-idf)
Sample             :
    Terms
Docs  agreement    appreci        arm   benghazi       boss
   1 0.09372950 0.06292734 0.06305152 0.12828049 0.09281579
   2 0.03236792 0.00000000 0.00000000 0.05062803 0.00000000</code></pre>
</div>
</div>
<p>Create term-document matrix (also called inverted index, see Han’s text in a later chapter):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb227"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb227-1"><a href="#cb227-1" aria-hidden="true" tabindex="-1"></a>TDData <span class="ot">&lt;-</span> <span class="fu">TermDocumentMatrix</span>(docs, <span class="at">control =</span> <span class="fu">list</span>(<span class="at">weighting =</span> weightTfIdf))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in TermDocumentMatrix.SimpleCorpus(docs, control = list(weighting =
weightTfIdf)): custom functions are ignored</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in weighting(x): empty document(s): 1931</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb230"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb230-1"><a href="#cb230-1" aria-hidden="true" tabindex="-1"></a><span class="fu">inspect</span>(TDData[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;&lt;TermDocumentMatrix (terms: 2, documents: 5)&gt;&gt;
Non-/sparse entries: 6/4
Sparsity           : 40%
Maximal term length: 9
Weighting          : term frequency - inverse document frequency (normalized) (tf-idf)
Sample             :
           Docs
Terms                1          2          3          4          5
  agreement 0.09372950 0.03236792 0.07881799 0.07580309 0.03906373
  appreci   0.06292734 0.00000000 0.00000000 0.00000000 0.00000000</code></pre>
</div>
</div>
</section>
<section id="explore-the-dataset" class="level2">
<h2 class="anchored" data-anchor-id="explore-the-dataset">Explore the dataset</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb232"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb232-1"><a href="#cb232-1" aria-hidden="true" tabindex="-1"></a><span class="fu">findFreqTerms</span>(TDData, <span class="at">lowfreq =</span> <span class="dv">75</span>, <span class="at">highfreq =</span> <span class="dv">1000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "abedin"          "cheryl"          "huma"            "call"           
[5] "abedinhstategov"</code></pre>
</div>
</div>
<p>Find correlations among terms:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb234"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb234-1"><a href="#cb234-1" aria-hidden="true" tabindex="-1"></a><span class="fu">findAssocs</span>(TDData, <span class="at">terms =</span> <span class="st">"bill"</span>, <span class="at">corlimit =</span> <span class="fl">0.25</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$bill
burn 
0.26 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb236"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb236-1"><a href="#cb236-1" aria-hidden="true" tabindex="-1"></a><span class="fu">findAssocs</span>(DTData, <span class="at">terms=</span><span class="fu">c</span>(<span class="st">"bill"</span>), <span class="at">corlimit =</span> <span class="fl">0.25</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$bill
burn 
0.26 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb238"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb238-1"><a href="#cb238-1" aria-hidden="true" tabindex="-1"></a><span class="fu">findAssocs</span>(DTData, <span class="at">terms=</span><span class="fu">c</span>(<span class="st">"schedul"</span>), <span class="at">corlimit =</span> <span class="fl">0.3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$schedul
            lona          valmoro valmoroustategov 
            0.39             0.38             0.38 </code></pre>
</div>
</div>
</section>
<section id="create-a-word-cloud" class="level2">
<h2 class="anchored" data-anchor-id="create-a-word-cloud">Create a word cloud</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb240"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb240-1"><a href="#cb240-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(<span class="st">"wordcloud"</span>))</span>
<span id="cb240-2"><a href="#cb240-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">install.packages</span>(<span class="st">"wordcloud"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: wordcloud</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: RColorBrewer</code></pre>
</div>
<div class="sourceCode cell-code" id="cb243"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb243-1"><a href="#cb243-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(<span class="st">"RColorBrewer"</span>))</span>
<span id="cb243-2"><a href="#cb243-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">install.packages</span>(<span class="st">"RColorBrewer"</span>)</span>
<span id="cb243-3"><a href="#cb243-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(wordcloud)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb244"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb244-1"><a href="#cb244-1" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(TDData)</span>
<span id="cb244-2"><a href="#cb244-2" aria-hidden="true" tabindex="-1"></a>freq <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">rowSums</span>(data), <span class="at">decreasing =</span> <span class="cn">TRUE</span>)</span>
<span id="cb244-3"><a href="#cb244-3" aria-hidden="true" tabindex="-1"></a>base <span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="at">word =</span> <span class="fu">names</span>(freq), <span class="at">freq =</span> freq)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><code>png()</code> opens a new device 'png' to output the graph to a local file:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb245"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb245-1"><a href="#cb245-1" aria-hidden="true" tabindex="-1"></a><span class="fu">png</span>(<span class="at">file =</span> <span class="st">"wordCloud.png"</span>, <span class="at">width =</span> <span class="dv">1000</span>, <span class="at">height =</span> <span class="dv">700</span>, <span class="at">bg=</span> <span class="st">"grey30"</span>)</span>
<span id="cb245-2"><a href="#cb245-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb245-3"><a href="#cb245-3" aria-hidden="true" tabindex="-1"></a><span class="fu">wordcloud</span>(base<span class="sc">$</span>word, base<span class="sc">$</span>freq, <span class="at">col =</span> <span class="fu">terrain.colors</span>(<span class="fu">length</span>(base<span class="sc">$</span>word), <span class="at">alpha =</span> <span class="fl">0.9</span>), </span>
<span id="cb245-4"><a href="#cb245-4" aria-hidden="true" tabindex="-1"></a><span class="at">random.order =</span> <span class="cn">FALSE</span>, <span class="at">rot.per =</span> <span class="fl">0.3</span>, <span class="at">scale =</span> <span class="fu">c</span>(<span class="dv">1</span>, .<span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>dev.off() closed the .png file, now the current display is the default display in RStudio. Use dev.list() to find the graphics devices that are active, repeatedly use dev.off() to close devices that not needed. R Studio is the default display. When all other devices are closed, the default display is used.</p>
<p>Output the graph to the default display in RStudio</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb246"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb246-1"><a href="#cb246-1" aria-hidden="true" tabindex="-1"></a><span class="fu">wordcloud</span>(base<span class="sc">$</span>word, base<span class="sc">$</span>freq, <span class="at">col =</span> <span class="fu">terrain.colors</span>(<span class="fu">length</span>(base<span class="sc">$</span>word), <span class="at">alpha =</span> <span class="fl">0.9</span>), </span>
<span id="cb246-2"><a href="#cb246-2" aria-hidden="true" tabindex="-1"></a><span class="at">random.order =</span> <span class="cn">FALSE</span>, <span class="at">rot.per =</span> <span class="fl">0.3</span>, <span class="at">scale =</span> <span class="fu">c</span>(<span class="dv">1</span>, .<span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="r-python-exercise2_files/figure-html/unnamed-chunk-119-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Can we remove hrodclintonemailcom and redo the word cloud?</p>
<p>Sometimes we need to one-hot encoding a section of a dataframe. We can do it by using onehot package.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb247"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb247-1"><a href="#cb247-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(<span class="st">"onehot"</span>))</span>
<span id="cb247-2"><a href="#cb247-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">install.packages</span>(<span class="st">"onehot"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: onehot</code></pre>
</div>
<div class="sourceCode cell-code" id="cb249"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb249-1"><a href="#cb249-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(onehot)</span>
<span id="cb249-2"><a href="#cb249-2" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">language=</span><span class="fu">c</span>(<span class="st">"javascript"</span>, <span class="st">"python"</span>, <span class="st">"java"</span>), <span class="at">hours=</span><span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">3</span>, <span class="dv">5</span>) )</span>
<span id="cb249-3"><a href="#cb249-3" aria-hidden="true" tabindex="-1"></a>d<span class="sc">$</span>language <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(d<span class="sc">$</span>language) <span class="co">#convert the column to be encoded to Factor</span></span>
<span id="cb249-4"><a href="#cb249-4" aria-hidden="true" tabindex="-1"></a>encoded <span class="ot">&lt;-</span> <span class="fu">onehot</span>(d)</span>
<span id="cb249-5"><a href="#cb249-5" aria-hidden="true" tabindex="-1"></a>new_d <span class="ot">&lt;-</span> <span class="fu">predict</span>(encoded, d)</span>
<span id="cb249-6"><a href="#cb249-6" aria-hidden="true" tabindex="-1"></a>new_d</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     language=java language=javascript language=python hours
[1,]             0                   1               0    10
[2,]             0                   0               1     3
[3,]             1                   0               0     5</code></pre>
</div>
</div>
<p>One hot encoding for data frame with multi-value cells (language = “javascript, python”)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb251"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb251-1"><a href="#cb251-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(<span class="st">"qdapTools"</span>))</span>
<span id="cb251-2"><a href="#cb251-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">install.packages</span>(<span class="st">"qdapTools"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: qdapTools</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'qdapTools'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:dplyr':

    id</code></pre>
</div>
<div class="sourceCode cell-code" id="cb255"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb255-1"><a href="#cb255-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(qdapTools)</span>
<span id="cb255-2"><a href="#cb255-2" aria-hidden="true" tabindex="-1"></a>d <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">language=</span><span class="fu">c</span>(<span class="st">"javascript, python"</span>, <span class="st">"java"</span>), <span class="at">hours =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">5</span>) )</span>
<span id="cb255-3"><a href="#cb255-3" aria-hidden="true" tabindex="-1"></a>d</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            language hours
1 javascript, python     3
2               java     5</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb257"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb257-1"><a href="#cb257-1" aria-hidden="true" tabindex="-1"></a>dlist <span class="ot">&lt;-</span> <span class="fu">as.list</span>(d)</span>
<span id="cb257-2"><a href="#cb257-2" aria-hidden="true" tabindex="-1"></a>new_d <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">cbind</span>(dlist, <span class="fu">mtabulate</span>(<span class="fu">strsplit</span>(<span class="fu">as.character</span>(dlist<span class="sc">$</span>language), <span class="st">", "</span>)))) </span>
<span id="cb257-3"><a href="#cb257-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb257-4"><a href="#cb257-4" aria-hidden="true" tabindex="-1"></a>new_d</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            language hours java javascript python
1 javascript, python     3    0          1      1
2               java     5    1          0      0</code></pre>
</div>
</div>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>